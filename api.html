<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" type="image/png" href="./images/favicon.png" />
  <title>Elite Skins | A maior comunidade de skins de CS2 do Brasil</title>
  <meta name="description" content="Elite Skins: Comunidade brasileira de troca e negocia√ß√£o de skins de Counter Strike 2. Trading, premia√ß√µes e ofertas." />
  <meta name="keywords" content="CS2, Counter Strike 2, skins, trading, comunidade, grupos, ofertas, premia√ß√µes" />
  <link rel="stylesheet" href="index.css" />
  <link rel="stylesheet" href="background.css" />
  <link rel="stylesheet" href="mobile.css" media="screen and (max-width: 768px)" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;500;600;700;800;900&family=Teko:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {

    /* Corre√ß√£o global para bot√µes rosados */
    .btn-gradient:hover, .btn-gradient:focus,
    .btn-cs2:hover, .btn-cs2:focus,
    .btn-pink:hover, .btn-pink:focus {
      background: var(--cs2-gradient-gold) !important;
      color: var(--cs2-bg-dark) !important;
      box-shadow: 0 6px 15px rgba(255, 215, 0, 0.4) !important;
    }
    .btn-blue:hover, .btn-blue:focus {
      background: linear-gradient(45deg, var(--cs2-info-blue), var(--cs2-secondary-blue)) !important;
      color: #fff !important;
      box-shadow: 0 6px 15px rgba(35, 137, 218, 0.4) !important;
    }
    .btn-green:hover, .btn-green:focus {
      background: linear-gradient(45deg, var(--cs2-accent-green), var(--cs2-bg-dark)) !important;
      color: #fff !important;
      box-shadow: 0 6px 15px rgba(75, 158, 42, 0.4) !important;
    }

      --cs2-primary-gold: #FFD700;
      --cs2-secondary-blue: #131E2B;
      --cs2-bg-dark: #0A0E12;
      --cs2-accent-orange: #FF6600;
      --cs2-text-light: #F5F5F5;
      --cs2-accent-green: #4B9E2A;
      --cs2-danger-red: #DD3333;
      --cs2-info-blue: #2389DA;
      --cs2-radial-dark: radial-gradient(circle at center, #182233 0%, #0A0E12 100%);
      --cs2-gradient-blue: linear-gradient(135deg, #131E2B 0%, #0A0E12 100%);
      --cs2-gradient-gold: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      --cs2-glitch-border: 2px solid rgba(255, 215, 0, 0.6);
      --gamer-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Rajdhani', sans-serif;
      background-color: var(--cs2-bg-dark);
      /* Background movido para o arquivo background.css */
      color: var(--cs2-text-light);
      margin: 0;
      padding: 0;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    section {
      padding: 60px 0;
    }
    
    h1, h2, h3, h4 {
      margin: 0;
      line-height: 1.3;
      color: var(--cs2-primary-gold);
    }
    
    a {
      text-decoration: none;
      color: var(--cs2-primary-gold);
      transition: all 0.3s ease;
    }
    
    a:hover {
      color: var(--cs2-accent-orange);
      text-shadow: 0 0 8px rgba(255, 102, 0, 0.5);
    }
    
    .btn {
      display: inline-block;
      padding: 10px 25px;
      font-family: 'Teko', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      text-align: center;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
    }
    
    .btn-primary {
      background: var(--cs2-gradient-gold);
      color: var(--cs2-bg-dark);
      border: none;
      text-shadow: 0 1px 0 rgba(0,0,0,0.2);
    }
    
    .btn-primary:hover {
      background: var(--cs2-gradient-gold);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(255, 215, 0, 0.4);
      color: var(--cs2-bg-dark);
    }
    
    .btn-outline {
      background-color: rgba(255, 215, 0, 0.1);
      border: 2px solid var(--cs2-primary-gold);
      color: var(--cs2-primary-gold);
    }
    
    .btn-outline:hover {
      background: var(--cs2-gradient-gold);
      color: var(--cs2-bg-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(255, 215, 0, 0.4);
      border-color: transparent;
    }
    
    .btn::after {
      content: '';
      position: absolute;
      height: 100%;
      width: 150px;
      top: 0;
      left: -150px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: 0.5s;
    }
    
    .btn:hover::after {
      left: 100%;
    }
    
    h1, h2, h3, h4 {
      font-family: 'Orbitron', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--cs2-primary-gold);
      text-shadow: 0px 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    h1 {
      font-size: 2.8rem;
      background: var(--cs2-gradient-gold);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }

    .header {
      background-color: rgba(19, 30, 43, 0.9);
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 100;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
      height: auto;
      border-bottom: 1px solid rgba(255, 215, 0, 0.3);
      backdrop-filter: blur(10px);
    }
    
    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
    }
    
    .logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 28px;
      font-weight: 900;
      color: var(--cs2-primary-gold);
      letter-spacing: 2px;
      text-transform: uppercase;
      position: relative;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
      transition: all 0.3s ease;
    }
    
    .logo:hover {
      color: var(--cs2-primary-gold);
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
    }
    
    .logo::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--cs2-gradient-gold);
    }
    
    .nav {
      display: flex;
      gap: 25px;
    }
    
    .nav a {
      color: var(--cs2-text-light);
      font-weight: 600;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      padding: 5px 10px;
      font-size: 1.1rem;
    }
    
    .nav a:hover {
      color: var(--cs2-primary-gold);
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
    }
    
    .nav a::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 10px;
      width: 0;
      height: 2px;
      background: var(--cs2-primary-gold);
      transition: width 0.3s ease;
    }
    
    .nav a:hover::before {
      width: calc(100% - 20px);
    }
  </style>
</head>

<body>
  <!-- ***** Header ***** -->
  <header class="header" id="top">
    <div class="container header-inner">
      <a href="#top" class="logo">Elite Skins</a>
      <nav class="nav">
        <a href="https://elite-skins-2025.github.io/" class="scroll-top-link">Voltar</a>
        <a href="#ofertas">Acessar Steam</a>
        <a href="#avaliacao">Avalia√ß√£o</a>
      </nav>
      <a href="#avaliacao" class="btn btn-primary">Avalia√ß√£o de Invent√°rio</a>
    </div>
  </header>

  <!-- SheetJS library for Excel export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
  
  <!-- Plotly.js for interactive charts -->
  <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
  
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>

  <main style="padding-top: 80px;">
  <!-- ***** Hero Section ***** -->
  <section class="hero" id="hero" style="padding-top:60px; padding-bottom:60px; position: relative; overflow: hidden;">

    <div class="container" style="display:grid; grid-template-columns: 1fr 1fr; gap:40px; position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; padding: 0 20px;">
      <!-- Text Content Left Side -->
      <div style="position: relative; padding: 30px 0;">
        <!-- Corner accents -->
        <div style="position: absolute; top: 0; left: 0; width: 80px; height: 80px; border-top: 3px solid var(--cs2-primary-gold); border-left: 3px solid var(--cs2-primary-gold); opacity: 0.8;"></div>
        <div style="position: absolute; bottom: 0; right: 0; width: 80px; height: 80px; border-bottom: 3px solid var(--cs2-accent-orange); border-right: 3px solid var(--cs2-accent-orange); opacity: 0.8;"></div>
        
        <!-- Main content with padding for the corners -->
        <div style="padding: 20px 10px; position: relative;">
          <!-- Main heading -->
          <h1 style="font-family: 'Orbitron', sans-serif; font-size:2.5rem; margin-bottom:1.5rem; text-transform: uppercase; line-height: 1.2; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">
            A MAIOR <span style="color: var(--cs2-primary-gold);">COMUNIDADE</span><br>
            <span style="color: var(--cs2-accent-orange);">DE SKINS DE CS2</span><br>
            DO BRASIL
          </h1>
          
          <!-- Descriptive paragraph -->
          <p style="font-size:1.25rem; margin-bottom:2.5rem; color:var(--cs2-text-light); font-family: 'Rajdhani', sans-serif; max-width: 500px; position: relative;">
            Junte-se √† comunidade com mais de <span style="color:var(--cs2-primary-gold); font-weight:bold; font-size: 1.4rem;">R$ 1.000.000,00</span> movimentados em 2024. <span style="color: var(--cs2-accent-orange);">Negocia√ß√µes seguras</span> e ofertas rel√¢mpago.
          </p>
          
          <!-- CTA Buttons -->
          <div style="display:flex; gap:20px; flex-wrap:wrap; margin-top: 1rem;">
            <a href="#avaliacao" class="btn btn-primary" style="font-weight: 600; padding: 12px 28px; letter-spacing: 1px;">Avalia√ß√£o de Invent√°rio</a>
          </div>

          <!-- Stats indicator -->
          <div style="margin-top: 2.5rem; display: flex; align-items: center;">
            <span style="display: inline-block; width: 8px; height: 8px; background: var(--cs2-accent-green); border-radius: 50%; animation: pulse 1.5s infinite; margin-right: 10px;"></span>
            <span style="color: rgba(255,255,255,0.7); font-family: 'Rajdhani', sans-serif; font-size: 0.9rem;">+560 negocia√ß√µes conclu√≠das esta semana</span>
          </div>
        </div>
      </div>
      
      <!-- Logo Right Side -->
      <div style="display: flex; align-items: center; justify-content: center; position: relative;">
        <!-- Background glow effect -->
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 350px; height: 350px; background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%); border-radius: 50%; z-index: -1;"></div>
        
        <!-- Logo container with border effect -->
        <div style="width: 320px; height: 320px; display: flex; align-items: center; justify-content: center; position: relative; background: rgba(15,20,25,0.5); border-radius: 10px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,215,0,0.1);">
          <!-- Border light effect -->
          <div style="position: absolute; inset: 0; border: 1px solid rgba(255,215,0,0.3); border-radius: 10px; box-shadow: inset 0 0 30px rgba(255,215,0,0.1); z-index: 0;"></div>
          
          <!-- Logo image with effects -->
          <img src="./images/elite_logo.png" alt="Elite Skins Logo" style="max-width: 88%; height: auto; filter: drop-shadow(0 5px 15px rgba(255,215,0,0.3)); transform: perspective(800px) rotateY(-5deg); transition: transform 0.5s ease; z-index: 1;">
        </div>
      </div>
    </div>
    
    <!-- Bottom accent line -->
    <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 5px; background: linear-gradient(90deg, var(--cs2-primary-gold), var(--cs2-accent-orange), var(--cs2-primary-gold)); opacity: 0.7;"></div>
  </section>

  <!-- ***** Se√ß√£o de Avalia√ß√£o de Invent√°rio ***** -->
  <section id="ofertas" style="background: linear-gradient(165deg, #192736 0%, #0b1015 100%); position: relative; overflow: hidden; border-top: 1px solid rgba(255,215,0,0.1); border-bottom: 1px solid rgba(255,215,0,0.1); padding: 60px 0;">
    <!-- Material design subtle diagonal accent -->
    <div style="position: absolute; top: -100px; right: -100px; width: 300px; height: 300px; background: radial-gradient(circle at top right, rgba(255,147,0,0.03) 0%, transparent 70%); z-index: 0;"></div>
    
    <!-- Material design light patterns -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(135deg, rgba(255,215,0,0.02) 25%, transparent 25%), linear-gradient(225deg, rgba(255,215,0,0.02) 25%, transparent 25%); background-size: 60px 60px; opacity: 0.5; z-index: 0;"></div>
    
    <div class="container" style="position: relative; z-index: 1;">
      <div style="text-align:center; margin-bottom:3rem; position: relative;">
        <h2 id="avaliacao" style="text-align:center; margin-bottom:0.5rem; font-size: 2.8rem; text-transform: uppercase;">Avalia√ß√£o de Invent√°rio</h2>
        <p style="color: var(--cs2-accent-orange); font-family: 'Rajdhani', sans-serif; font-weight: 600; font-size: 1.2rem; letter-spacing: 1px; text-transform: uppercase;">Descubra o valor real de suas skins de CS2</p>
        <div style="width: 80px; height: 4px; background: var(--cs2-gradient-gold); margin: 1rem auto;"></div>
      </div>
      
      <!-- API Status Indicator -->
      <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 2rem;">
        <div style="display: inline-flex; align-items: center; padding: 4px 12px; background: rgba(10,14,18,0.5); border-radius: 4px; border: 1px solid rgba(255,215,0,0.2);">
          <div id="api-status-indicator" style="width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; background-color: #777;"></div>
          <span id="api-status-text" style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); font-size: 0.9rem;">Verificando status da API...</span>
        </div>
        
        <!-- Exchange Rate Indicator (NEW) -->
        <div style="display: inline-flex; align-items: center; padding: 4px 12px; background: rgba(10,14,18,0.5); border-radius: 4px; border: 1px solid rgba(255,215,0,0.2); margin-left: 10px;">
          <div id="exchange-rate-indicator" style="width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; background-color: #777;"></div>
          <span id="exchange-rate-text" style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); font-size: 0.9rem;">Atualizando taxa de c√¢mbio...</span>
        </div>
      </div>
      
      <!-- Authentication Section (NEW) -->
      <div id="auth-section" style="text-align: center; margin-bottom: 2rem; background: linear-gradient(135deg, rgba(26,38,52,0.6) 0%, rgba(10,14,18,0.8) 100%); border-radius: 8px; padding: 20px; border: 1px solid rgba(255,215,0,0.2);">
        <h3 style="font-family: 'Orbitron', sans-serif; color:var(--cs2-primary-gold); margin-bottom:1rem; font-size: 1.6rem; text-transform: uppercase;">Autentica√ß√£o Steam</h3>
        <p style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); margin-bottom: 1.5rem; line-height: 1.6;">Conecte com sua conta Steam para acessar recursos avan√ßados, incluindo an√°lise completa do invent√°rio com acesso √†s Unidades de Armazenamento.</p>
        
        <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 1rem;">
          <button id="login-btn" class="btn" style="display: inline-flex; padding: 10px 25px; background: linear-gradient(135deg, #2f526f 0%, #1c2838 100%); color: var(--cs2-text-light); border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; cursor: pointer;">
            <div style="display: flex; align-items: center; justify-content: center; width: 100%;">
              <img src="./images/steam.png" alt="Steam" style="height: 20px; width: 20px; display: block; margin-right: 10px;">
              <span style="display: block;">LOGIN COM STEAM</span>
            </div>
          </button>
          
          <!-- Bot√£o de teste para URL de retorno -->
          <button id="test-redirect-btn" class="btn" style="display: none; padding: 10px 25px; margin-left: 10px; background: linear-gradient(135deg, #614080 0%, #4a2c6a 100%); color: var(--cs2-text-light); border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; cursor: pointer;">
            <div style="display: flex; align-items: center; justify-content: center; width: 100%;">
              <span style="display: block;">TESTAR RETORNO</span>
            </div>
          </button>
          
          <button id="logout-btn" class="btn" style="display: none; padding: 10px 25px; background: rgba(221,51,51,0.2); color: var(--cs2-danger-red); border: 1px solid var(--cs2-danger-red); border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; cursor: pointer;">
            Desconectar
          </button>
        </div>
        
        <div id="user-info" style="display: none; font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); background: rgba(10,14,18,0.5); padding: 8px 12px; border-radius: 4px; display: inline-block; margin-top: 10px;"></div>
        
        <!-- Bot√£o para analisar pr√≥prio invent√°rio (aparece apenas quando logado) -->
        <div id="my-inventory-btn-container" style="display: none; margin-top: 15px;">
          <button id="my-inventory-btn" class="btn btn-primary" style="padding: 12px 28px; background: linear-gradient(135deg, var(--cs2-primary-gold) 0%, var(--cs2-accent-orange) 100%); color: var(--cs2-bg-dark); border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">
            Analisar Meu Invent√°rio
          </button>
        </div>
      </div>
      
      <!-- API Tabs -->
      <div style="position: relative; margin-top: 2rem;">
        <div style="display: flex; border-bottom: 1px solid rgba(255,215,0,0.2); flex-wrap: wrap;">
          <button class="api-tab active" data-tab="inventory" style="font-family: 'Rajdhani', sans-serif; padding: 10px 20px; margin-right: 5px; background: none; border: none; color: var(--cs2-primary-gold); font-size: 1.1rem; font-weight: 600; cursor: pointer; position: relative; letter-spacing: 1px; transition: all 0.3s ease;">INVENT√ÅRIO</button>
          <button class="api-tab" data-tab="price" style="font-family: 'Rajdhani', sans-serif; padding: 10px 20px; margin-right: 5px; background: none; border: none; color: var(--cs2-text-light); font-size: 1.1rem; font-weight: 600; cursor: pointer; position: relative; letter-spacing: 1px; transition: all 0.3s ease;">PRE√áO DE SKIN</button>
        </div>
        
        <!-- Tab Content -->
        <div style="margin-top: 2rem; background: linear-gradient(135deg, rgba(26,38,52,0.6) 0%, rgba(10,14,18,0.8) 100%); border: 1px solid rgba(255,215,0,0.2); border-radius: 8px; padding: 30px; position: relative; overflow: hidden;">
          <!-- Glowing corner effect -->
          <div style="position: absolute; top: -2px; left: -2px; width: 20px; height: 20px; border-top: 2px solid var(--cs2-primary-gold); opacity: 0.7;"></div>
          <div style="position: absolute; bottom: -2px; right: -2px; width: 20px; height: 20px; border-bottom: 2px solid var(--cs2-primary-gold); border-right: 2px solid var(--cs2-primary-gold); opacity: 0.7;"></div>
          
          <!-- Tab 1: Invent√°rio -->
          <div class="tab-content active" id="inventory-tab">
            <div>
              <h3 style="font-family: 'Orbitron', sans-serif; color:var(--cs2-primary-gold); margin-bottom:1.5rem; font-size: 1.6rem; text-transform: uppercase; text-align: center;">An√°lise de Invent√°rio</h3>
              <p style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); margin-bottom: 1.5rem; line-height: 1.6; text-align: center;">Conecte sua conta Steam para obter uma an√°lise completa do seu invent√°rio de CS2, incluindo o valor total, itens mais valiosos e estat√≠sticas detalhadas.</p>
              
              <div id="auth-section-container" style="display: none; flex-direction: column; align-items: center; justify-content: center; margin: 2rem 0;">
                <!-- Autentica√ß√£o Steam - Vers√£o destaque -->
                <div id="auth-section-highlight" style="text-align: center; margin-bottom: 2rem; background: linear-gradient(135deg, rgba(26,38,52,0.8) 0%, rgba(10,14,18,0.9) 100%); border-radius: 8px; padding: 30px; border: 1px solid rgba(255,215,0,0.3); max-width: 600px; width: 100%;">
                  <h3 style="font-family: 'Orbitron', sans-serif; color:var(--cs2-primary-gold); margin-bottom:1rem; font-size: 1.6rem; text-transform: uppercase;">Autentica√ß√£o Steam</h3>
                  <p style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); margin-bottom: 1.5rem; line-height: 1.6;">Conecte com sua conta Steam para acessar recursos avan√ßados, incluindo an√°lise completa do invent√°rio com acesso √†s Unidades de Armazenamento.</p>
                  
                  <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 1rem;">
                    <button id="login-btn" class="btn" style="display: inline-flex; padding: 12px 30px; background: linear-gradient(135deg, #2f526f 0%, #1c2838 100%); color: var(--cs2-text-light); border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.2rem; cursor: pointer;">
                      <div style="display: flex; align-items: center; justify-content: center; width: 100%;">
                        <img src="./images/steam.png" alt="Steam" style="height: 20px; width: 20px; display: block; margin-right: 10px;">
                        <span style="display: block;">LOGIN COM STEAM</span>
                      </div>
                    </button>
                    
                    <button id="logout-btn" class="btn" style="display: none; padding: 12px 30px; background: rgba(221,51,51,0.2); color: var(--cs2-danger-red); border: 1px solid var(--cs2-danger-red); border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.2rem; cursor: pointer;">
                      Desconectar
                    </button>
                  </div>
                  
                  <div id="user-info" style="display: none; font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); background: rgba(10,14,18,0.5); padding: 12px 20px; border-radius: 4px; display: inline-block; margin-top: 15px; font-size: 1.1rem;"></div>
                </div>
                
                <!-- Bot√£o para analisar pr√≥prio invent√°rio (aparece apenas quando logado) -->
                <div id="my-inventory-btn-container" style="display: none; margin-top: 15px; text-align: center;">
                  <button id="my-inventory-btn" class="btn btn-primary" style="padding: 15px 40px; background: linear-gradient(135deg, var(--cs2-primary-gold) 0%, var(--cs2-accent-orange) 100%); color: var(--cs2-bg-dark); border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1.3rem; font-weight: 600; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">
                    Analisar Meu Invent√°rio
                  </button>
                  <p style="margin-top: 10px; color: var(--cs2-text-light); font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; opacity: 0.7;">
                    An√°lise completa incluindo conte√∫do das Unidades de Armazenamento
                  </p>
                </div>
              </div>
              
              <div id="inventory-result" style="opacity: 0; display: flex; flex-direction: column; background: rgba(10,14,18,0.5); border-radius: 8px; border: 1px solid rgba(255,215,0,0.2); padding: 20px; transition: opacity 0.5s ease; max-width: 800px; margin: 0 auto;">
                <div id="inventory-loading" style="display: none; text-align: center; padding: 2rem;">
                  <div style="border: 4px solid rgba(255,215,0,0.1); border-left: 4px solid var(--cs2-primary-gold); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                  <p style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light);">Analisando invent√°rio...</p>
                </div>
                
                <div id="inventory-data" style="display: none; height: 100%;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,215,0,0.2); padding-bottom: 10px;">
                    <h4 style="font-family: 'Orbitron', sans-serif; color: var(--cs2-primary-gold); margin: 0; font-size: 1.2rem;">An√°lise de Invent√°rio</h4>
                    <span id="inventory-total-value" style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-accent-orange); font-weight: 700; font-size: 1.3rem;">R$ 0,00</span>
                  </div>
                  
                  <div id="export-button-container" style="text-align: right; margin-bottom: 15px;">
                    <button id="export-excel-btn" class="btn" style="padding: 6px 12px; background: linear-gradient(to right, #4B9E2A, #2f7c1e); color: white; border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center;">
                      <span style="margin-right: 5px;">üìä</span> Exportar para Excel
                    </button>
                    <button id="generate-dashboard-btn" class="btn" style="margin-left: 10px; padding: 6px 12px; background: linear-gradient(to right, #2389DA, #1a6ca8); color: white; border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center;">
                      <span style="margin-right: 5px;">üìà</span> Dashboard Interativa
                    </button>
                  </div>
                  
                  <div style="overflow-y: auto; flex: 1; padding-right: 10px;">
                    <div id="inventory-summary"></div>
                    <div id="inventory-items" style="margin-top: 1rem; max-height: 350px; overflow-y: auto; padding-right: 10px;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Tab 2: Pre√ßo de Skin -->
          <div class="tab-content" id="price-tab" style="display: none;">
            <!-- Conte√∫do tab pre√ßo permanece igual -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
              <div>
                <h3 style="font-family: 'Orbitron', sans-serif; color:var(--cs2-primary-gold); margin-bottom:1.5rem; font-size: 1.6rem; text-transform: uppercase;">Pre√ßo de Skin</h3>
                <p style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); margin-bottom: 1.5rem; line-height: 1.6;">Consulte o pre√ßo atualizado de qualquer skin do CS2. Basta inserir o nome exato (market hash name) da skin para obter seu valor atual no mercado.</p>
                
                <div style="margin-bottom: 1.5rem;">
                  <label for="skin-name" style="display: block; font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); margin-bottom: 5px; font-weight: 600;">Nome da Skin:</label>
                  <div style="display: flex;">
                    <input type="text" id="skin-name" placeholder="Ex: AWP | Asiimov (Field-Tested)" style="flex: 1; background: rgba(10,14,18,0.7); border: 1px solid rgba(255,215,0,0.3); padding: 10px 15px; color: var(--cs2-text-light); font-family: 'Rajdhani', sans-serif; border-radius: 4px; font-size: 1rem;">
                    <button id="price-btn" class="btn btn-primary" style="margin-left: 10px; text-transform: uppercase; padding: 10px 20px; background: var(--cs2-gradient-gold); color: var(--cs2-bg-dark); border: none; font-family: 'Teko', sans-serif; font-size: 1.2rem; cursor: pointer; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);">Buscar</button>
                  </div>
                </div>
                
                <div style="margin-top: 1.5rem;">
                  <p style="font-family: 'Rajdhani', sans-serif; color: rgba(255,255,255,0.6); font-size: 0.9rem; font-style: italic;">* O nome da skin precisa ser exato, incluindo o desgaste (Field-Tested, Factory New, etc.)</p>
                </div>
              </div>
              
              <div>
                <div id="price-result" style="opacity: 0; height: 100%; display: flex; flex-direction: column; background: rgba(10,14,18,0.5); border-radius: 8px; border: 1px solid rgba(255,215,0,0.2); padding: 20px; transition: opacity 0.5s ease;">
                  <div id="price-loading" style="display: none; text-align: center; padding: 2rem;">
                    <div style="border: 4px solid rgba(255,215,0,0.1); border-left: 4px solid var(--cs2-primary-gold); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                    <p style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light);">Buscando pre√ßo...</p>
                  </div>
                  
                  <div id="price-data" style="display: none; height: 100%;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255,215,0,0.2); padding-bottom: 10px;">
                      <h4 style="font-family: 'Orbitron', sans-serif; color: var(--cs2-primary-gold); margin: 0; font-size: 1.2rem;">Informa√ß√µes da Skin</h4>
                    </div>
                    
                    <div id="price-info" style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light);"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          

        </div>
      </div>
    </div>
    
    <style>
      @keyframes pulse {
        0% { opacity: 0.4; }
        50% { opacity: 1; }
        100% { opacity: 0.4; }
      }
      
      @keyframes blink {
        0% { opacity: 0.6; }
        50% { opacity: 1; }
        100% { opacity: 0.6; }
      }
    </style>
  </section>

  </main>

  <!-- ***** Footer ***** -->
  <footer style="color:var(--cs2-text-light); padding:4rem 0 3rem; position: relative; overflow: hidden; border-top: 1px solid rgba(255,215,0,0.15);">
    <!-- Background image - header -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('./images/backgrounds/header.jpg'); background-size: cover; background-position: center; opacity: 0.5; z-index: 0;"></div>
    
    <!-- Gradient overlay -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(10,14,18,0.85) 0%, rgba(10,14,18,0.95) 100%); z-index: 0;"></div>
    
    <!-- Material design top edge highlight -->
    <div style="position: absolute; top: 0; left: 0; width: 100%; height: 1px; background: linear-gradient(to right, transparent, rgba(255,255,255,0.05), transparent); z-index: 0;"></div>
    
    <div class="container" style="position: relative; z-index: 1;">
      <div style="display:flex; flex-wrap:wrap; justify-content:space-between; gap:2.5rem;">
        <!-- About section -->
        <div style="flex:1 1 300px;">
          <h3 style="color:var(--cs2-primary-gold); margin-bottom:1.5rem; font-family: 'Orbitron', sans-serif; text-transform: uppercase; font-size: 1.5rem; letter-spacing: 1px; position: relative; display: inline-block;">
            <span style="position: relative; z-index: 1;">Elite Skins</span>
            <span style="position: absolute; bottom: -5px; left: 0; width: 100%; height: 3px; background: var(--cs2-primary-gold); opacity: 0.5;"></span>
          </h3>
          
          <p style="margin-bottom:1.5rem; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; line-height: 1.5;">A maior comunidade de skins de CS2 do Brasil. Trading, ofertas e premia√ß√µes todos os dias! <span style="color: var(--cs2-primary-gold); font-weight: 600;">Junte-se a n√≥s.</span></p>
          
          <div style="display:flex; gap:1.2rem; margin-top: 2rem;">
            <a href="https://www.instagram.com/eliteskins1/" target="_blank" style="color:var(--cs2-text-light); font-size:1.5rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(26,38,52,0.6) 0%, rgba(10,14,18,0.8) 100%); border-radius: 8px; border: 1px solid rgba(255,215,0,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 15px rgba(0,0,0,0.3)';this.style.color='var(--cs2-info-blue)';" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none';this.style.color='var(--cs2-text-light)';">
              <img src="./images/instagram.png" alt="Instagram" style="width: 20px; height: 20px;">
            </a>
            
            <a href="https://api.whatsapp.com/send?phone=5511999999999" target="_blank" style="color:var(--cs2-text-light); font-size:1.5rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(26,38,52,0.6) 0%, rgba(10,14,18,0.8) 100%); border-radius: 8px; border: 1px solid rgba(255,215,0,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 15px rgba(0,0,0,0.3)';this.style.color='var(--cs2-accent-green)';" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none';this.style.color='var(--cs2-text-light)';">
              <img src="./images/whatsapp.png" alt="WhatsApp" style="width: 20px; height: 20px;">
            </a>
            
            <a href="mailto:suporteeliteskins@gmail.com" style="color:var(--cs2-text-light); font-size:1.5rem; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(26,38,52,0.6) 0%, rgba(10,14,18,0.8) 100%); border-radius: 8px; border: 1px solid rgba(255,215,0,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 15px rgba(0,0,0,0.3)';this.style.color='var(--cs2-primary-gold)';" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none';this.style.color='var(--cs2-text-light)';">
              <img src="./images/email.png" alt="Email" style="width: 20px; height: 20px;">
            </a>
          </div>
        </div>
        
        <!-- Quick Links -->
        <div style="flex:1 1 200px;">
          <h3 style="color:var(--cs2-info-blue); margin-bottom:1.5rem; font-family: 'Orbitron', sans-serif; text-transform: uppercase; font-size: 1.5rem; letter-spacing: 1px; position: relative; display: inline-block;">
            <span style="position: relative; z-index: 1;">Links R√°pidos</span>
            <span style="position: absolute; bottom: -5px; left: 0; width: 100%; height: 3px; background: var(--cs2-info-blue); opacity: 0.5;"></span>
          </h3>
          
          <ul style="list-style:none; padding:0; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem;">
            <li style="margin-bottom:0.8rem;">
              <a href="#top" class="scroll-top-link" style="color:var(--cs2-text-light); text-decoration: none; display: flex; align-items: center; transition: transform 0.2s ease, color 0.2s ease;" onmouseover="this.style.color='var(--cs2-primary-gold)';this.style.transform='translateX(5px)';" onmouseout="this.style.color='var(--cs2-text-light)';this.style.transform='translateX(0)';">
                <span style="display: inline-block; width: 8px; height: 8px; background: var(--cs2-info-blue); margin-right: 10px; clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0 50%);"></span> In√≠cio
              </a>
            </li>
            <li style="margin-bottom:0.8rem;">
              <a href="#ofertas" style="color:var(--cs2-text-light); text-decoration: none; display: flex; align-items: center; transition: transform 0.2s ease, color 0.2s ease;" onmouseover="this.style.color='var(--cs2-primary-gold)';this.style.transform='translateX(5px)';" onmouseout="this.style.color='var(--cs2-text-light)';this.style.transform='translateX(0)';">
                <span style="display: inline-block; width: 8px; height: 8px; background: var(--cs2-accent-orange); margin-right: 10px; clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></span> Acessar Steam
              </a>
            </li>
            <li style="margin-bottom:0.8rem;">
              <a href="#avaliacao" style="color:var(--cs2-text-light); text-decoration: none; display: flex; align-items: center; transition: transform 0.2s ease, color 0.2s ease;" onmouseover="this.style.color='var(--cs2-primary-gold)';this.style.transform='translateX(5px)';" onmouseout="this.style.color='var(--cs2-text-light)';this.style.transform='translateX(0)';">
                <span style="display: inline-block; width: 8px; height: 8px; background: var(--cs2-accent-green); margin-right: 10px; clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></span> Avalia√ß√£o
              </a>
            </li>
          </ul>
        </div>
        
        <!-- Legal -->
        <div style="flex:1 1 300px;">
          <h3 style="color:var(--cs2-accent-green); margin-bottom:1.5rem; font-family: 'Orbitron', sans-serif; text-transform: uppercase; font-size: 1.5rem; letter-spacing: 1px; position: relative; display: inline-block;">
            <span style="position: relative; z-index: 1;">Aviso Legal</span>
            <span style="position: absolute; bottom: -5px; left: 0; width: 100%; height: 3px; background: var(--cs2-accent-green); opacity: 0.5;"></span>
          </h3>
          
          <p style="margin-bottom:1.5rem; font-family: 'Rajdhani', sans-serif; font-size: 1rem; background: rgba(10,14,18,0.5); padding: 15px; border-radius: 8px; border-left: 3px solid var(--cs2-primary-gold);">Elite Skins n√£o √© afiliada √† Valve ou ao Counter-Strike 2. Todas as marcas e nomes de produtos s√£o marcas comerciais de seus respectivos propriet√°rios.</p>
          
          <div style="font-family: 'Rajdhani', sans-serif; font-size: 1rem; margin-top: 2rem; display: flex; align-items: center;">
            <img src="./images/elite_logo.png" alt="Elite Skins Logo" style="height: 35px; margin-right: 10px; opacity: 0.8;">
            <p style="margin: 0; opacity: 0.8;">&copy; 2025 Elite Skins. Todos os direitos reservados.</p>
          </div>
        </div>
      </div>
      
      <!-- Copyright -->
      <div style="margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.05); text-align: center; font-family: 'Rajdhani', sans-serif; font-size: 1rem; color: rgba(255,255,255,0.5);">
        &copy; 2024 Elite Skins. Todos os direitos reservados.
      </div>
    </div>
  </footer>

  <script>
    // Countdown timer for eventos
    document.addEventListener('DOMContentLoaded', function() {
      // Get all countdown elements
      const countdownElements = document.querySelectorAll('[id^="countdown-"]');
      
      // Update countdown function
      function updateCountdown() {
        countdownElements.forEach(el => {
          // Get random time values for demo purposes
          const hours = Math.floor(Math.random() * 6);
          const minutes = Math.floor(Math.random() * 60);
          const seconds = Math.floor(Math.random() * 60);
          
          // Format time with leading zeros
          const formattedHours = hours.toString().padStart(2, '0');
          const formattedMinutes = minutes.toString().padStart(2, '0');
          const formattedSeconds = seconds.toString().padStart(2, '0');
          
          // Display time
          el.textContent = `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
        });
      }
      
      // Update countdown every 60 seconds
      updateCountdown();
      setInterval(updateCountdown, 60000);
    });
    
    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
      const menuToggle = document.querySelector('.menu-toggle');
      const nav = document.querySelector('.nav');
      
      if (menuToggle && nav) {
        menuToggle.addEventListener('click', function() {
          nav.classList.toggle('active');
          menuToggle.classList.toggle('active');
        });
      }
    });
    
    // Hover effects for cards
    document.addEventListener('DOMContentLoaded', function() {
      const cards = document.querySelectorAll('[style*="box-shadow: 0 8px 20px"]');
      
      cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-5px)';
          this.style.boxShadow = '0 15px 30px rgba(0,0,0,0.5)';
          
          // Find border and change it
          if (this.style.border) {
            this.style.borderColor = 'var(--cs2-primary-gold)';
          }
          
          // Find hover effect div and change opacity
          const hoverEffect = this.querySelector('[style*="position: absolute"][style*="opacity: 0"]');
          if (hoverEffect) {
            hoverEffect.style.opacity = '1';
          }
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
          this.style.boxShadow = '0 8px 20px rgba(0,0,0,0.4)';
          
          // Reset border
          if (this.style.border) {
            this.style.borderColor = 'rgba(255,215,0,0.2)';
          }
          
          // Reset hover effect
          const hoverEffect = this.querySelector('[style*="position: absolute"][style*="opacity: 1"]');
          if (hoverEffect) {
            hoverEffect.style.opacity = '0';
          }
        });
      });
    });
    
    // API Interface Scripts
    document.addEventListener('DOMContentLoaded', function() {
      // Detecta ambiente: localhost ou produ√ß√£o
      const isLocalhost = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
      
      // For√ßar o uso da API do Render para testes
      const forceProduction = true; // Defina como false para voltar ao comportamento normal
      
      // Base URL da API - Ser√° diferente dependendo do ambiente
      const API_BASE_URL = (forceProduction || !isLocalhost) 
                         ? 'https://cotacaocs2-production-56f0.up.railway.app'  // Ambiente de produ√ß√£o no Railway
                         : 'http://localhost:8000';  // Ambiente de desenvolvimento
      
      console.log(`Ambiente detectado: ${isLocalhost ? 'Desenvolvimento local' : 'Produ√ß√£o'}`);
      console.log(`Usando API: ${API_BASE_URL} (For√ßar produ√ß√£o: ${forceProduction})`);
      
      // Auth token para armazenar ap√≥s login
      let authToken = localStorage.getItem('steamAuthToken');
      
      // Vari√°vel para armazenar os dados do invent√°rio para exporta√ß√£o
      let lastInventoryData = null;
      
      // Elementos da p√°gina
      const apiStatusIndicator = document.getElementById('api-status-indicator');
      const apiStatusText = document.getElementById('api-status-text');
      const tabs = document.querySelectorAll('.api-tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      // Elementos da tab Invent√°rio
      const inventoryResult = document.getElementById('inventory-result');
      const inventoryLoading = document.getElementById('inventory-loading');
      const inventoryData = document.getElementById('inventory-data');
      const inventoryTotalValue = document.getElementById('inventory-total-value');
      const inventorySummary = document.getElementById('inventory-summary');
      const inventoryItems = document.getElementById('inventory-items');
      const exportExcelBtn = document.getElementById('export-excel-btn');
      
      // Elementos da tab Pre√ßo
      const skinNameInput = document.getElementById('skin-name');
      const priceBtn = document.getElementById('price-btn');
      const priceResult = document.getElementById('price-result');
      const priceLoading = document.getElementById('price-loading');
      const priceData = document.getElementById('price-data');
      const priceInfo = document.getElementById('price-info');
      

      
      // Elementos da autentica√ß√£o (adicionados)
      const authSection = document.getElementById('auth-section');
      const loginBtn = document.getElementById('login-btn');
      const logoutBtn = document.getElementById('logout-btn');
      const userInfo = document.getElementById('user-info');
      
      // Fun√ß√£o auxiliar para fazer requisi√ß√µes com headers personalizados
      async function fetchWithHeaders(endpoint, options = {}) {
          const defaultOptions = {
              method: 'GET',
              headers: {
                  'Accept': 'application/json',
                  'Content-Type': 'application/json',
                  'Cache-Control': 'no-cache, no-store, must-revalidate',
                  'Pragma': 'no-cache',
                  'Expires': '0'
              },
              credentials: 'same-origin',
              cache: 'no-cache',
              mode: 'cors' // Sempre usar modo CORS para todas as requisi√ß√µes
          };

          // Mesclar op√ß√µes padr√£o com as fornecidas
          const mergedOptions = {
              ...defaultOptions,
              ...options,
              headers: {
                  ...defaultOptions.headers,
                  ...(options.headers || {})
              }
          };

          // Fazer a requisi√ß√£o
          const response = await fetch(endpoint, mergedOptions);
          console.log(`Status da resposta: ${response.status}`);

          // Se a resposta n√£o for 2xx, lan√ßar erro
          if (!response.ok) {
              // Tentar obter detalhes do erro da resposta
              let errorMessage;
              try {
                  const errorData = await response.json();
                  errorMessage = errorData.error || errorData.detail || errorData.message || `Erro ${response.status}`;
              } catch (e) {
                  errorMessage = `Erro ${response.status}: ${response.statusText}`;
              }
              
              throw new Error(errorMessage);
          }

          // Verificar se a resposta est√° vazia
          const contentType = response.headers.get('content-type');
          if (contentType && contentType.includes('application/json')) {
              return await response.json();
          } else {
              return await response.text();
          }
      }
      
      // Verificar status da API
      function checkApiStatus() {
        const statusEndpoint = `${API_BASE_URL}/api/status`;
        console.log('Verificando status da API em:', statusEndpoint);
        
        // Ativar indicador visual de verifica√ß√£o
        if (apiStatusIndicator) {
          apiStatusIndicator.style.backgroundColor = '#777';
          apiStatusText.textContent = 'Verificando API...';
        }
        
        // Vari√°vel para controlar se j√° tivemos resposta
        let hasResponded = false;
        
        // Usar um timeout para limitar o tempo de espera
        const timeoutPromise = new Promise((_, reject) => {
          setTimeout(() => {
            if (!hasResponded) {
              console.log('Timeout atingido, mas continuaremos esperando a resposta em background');
              reject(new Error('Timeout ao verificar API'));
            }
          }, 20000); // Aumentado para 20 segundos para evitar timeouts prematuros
        });
        
        // SOLU√á√ÉO MELHORADA: Use fetch com modo no-cors para apenas verificar se a API est√° online
        fetch(`${API_BASE_URL}/api/status?_=${Date.now()}`, {
          method: 'GET',
          mode: 'no-cors', // Isso permite a verifica√ß√£o sem erros CORS, mas n√£o permite ler a resposta
          cache: 'no-cache',
          credentials: 'omit',
          timeout: 15000 // 15 segundos de timeout
        })
        .then(response => {
          hasResponded = true;
          console.log('API respondeu com sucesso');
          apiStatusIndicator.style.backgroundColor = 'var(--cs2-accent-green)';
          apiStatusText.textContent = 'API online | DB: Conectado';
          
          // Remover bot√£o de retry se existir
          const retryButton = document.getElementById('api-status-retry-btn');
          if (retryButton && retryButton.parentNode) {
            retryButton.parentNode.removeChild(retryButton);
          }
          
          loadCases(); // Carrega a lista de caixas se a API estiver online
        })
        .catch(error => {
          // Tentar m√©todo alternativo se fetch falhar
          checkApiStatusFallback();
        });
        
        // Iniciar o timeout, mas n√£o bloquear outras opera√ß√µes
        timeoutPromise.catch(error => {
          // Apenas mostramos o erro de timeout se ainda n√£o tivermos uma resposta
          if (!hasResponded) {
            console.error('Erro ao verificar status da API:', error.message);
            apiStatusIndicator.style.backgroundColor = 'var(--cs2-danger-red)';
            apiStatusText.textContent = `API offline (Timeout)`;
            
            addRetryButton();
          }
        });
      }
      
      // M√©todo de fallback para verificar API status usando script
      function checkApiStatusFallback() {
        console.log('Tentando m√©todo alternativo para verificar status da API');
        
        // Criar um elemento de script para JSONP
        const script = document.createElement('script');
        const callbackName = 'apiStatusCallback_' + Date.now();
        const timestamp = Date.now();
        
        // Definir uma fun√ß√£o global tempor√°ria para callback
        window[callbackName] = function(data) {
          console.log('API respondeu com sucesso (via JSONP)');
          apiStatusIndicator.style.backgroundColor = 'var(--cs2-accent-green)';
          apiStatusText.textContent = 'API online | DB: Conectado';
          
          // Remover bot√£o de retry se existir
          const retryButton = document.getElementById('api-status-retry-btn');
          if (retryButton && retryButton.parentNode) {
            retryButton.parentNode.removeChild(retryButton);
          }
          
          loadCases(); // Carrega a lista de caixas se a API estiver online
          
          // Limpar a fun√ß√£o global
          delete window[callbackName];
          
          // Remover o script
          if (script.parentNode) {
            script.parentNode.removeChild(script);
          }
        };
        
        // Configurar timeout local para o script
        const scriptTimeout = setTimeout(() => {
          console.error('Erro ao verificar status da API via JSONP: Timeout');
          // Remover a fun√ß√£o global
          delete window[callbackName];
          
          // Tentar terceiro m√©todo de fallback usando iframe
          checkApiStatusFallbackIframe();
        }, 10000);
        
        // Quando o script falhar
        script.onerror = function() {
          clearTimeout(scriptTimeout);
          console.error('Erro ao verificar status da API via JSONP: Falha no script');
          
          // Remover a fun√ß√£o global
          delete window[callbackName];
          
          // Tentar terceiro m√©todo de fallback usando iframe
          checkApiStatusFallbackIframe();
        };
        
        // Configurar URL do script
        script.src = `${API_BASE_URL}/api/status?callback=${callbackName}&_=${timestamp}`;
        
        // Adicionar o script ao documento
        document.head.appendChild(script);
      }
      
      // M√©todo de fallback usando iframe (final)
      function checkApiStatusFallbackIframe() {
        console.log('Tentando m√©todo final para verificar status da API (iframe)');
        
        // Criar um iframe invis√≠vel
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.id = 'api-status-iframe';
        
        // Definir timeout
        const iframeTimeout = setTimeout(() => {
          console.error('Erro ao verificar status da API via iframe: Timeout');
          apiStatusIndicator.style.backgroundColor = 'var(--cs2-danger-red)';
          apiStatusText.textContent = 'API offline';
          
          // Remover iframe
          if (iframe.parentNode) {
            document.body.removeChild(iframe);
          }
          
          // Adicionar bot√£o de retry
          addRetryButton();
          
          // Inicializar de qualquer forma para permitir uso offline
          loadDefaultData();
        }, 10000);
        
        // Evento de carga
        iframe.onload = function() {
          clearTimeout(iframeTimeout);
          console.log('API respondeu com sucesso (via iframe)');
          apiStatusIndicator.style.backgroundColor = 'var(--cs2-accent-green)';
          apiStatusText.textContent = 'API online | DB: Conectado';
          
          // Remover bot√£o de retry se existir
          const retryButton = document.getElementById('api-status-retry-btn');
          if (retryButton && retryButton.parentNode) {
            retryButton.parentNode.removeChild(retryButton);
          }
          
          // Remover iframe
          document.body.removeChild(iframe);
          
          loadCases(); // Carrega a lista de caixas se a API estiver online
        };
        
        // Evento de erro
        iframe.onerror = function() {
          clearTimeout(iframeTimeout);
          console.error('Erro ao verificar status da API via iframe: Falha ao carregar');
          apiStatusIndicator.style.backgroundColor = 'var(--cs2-danger-red)';
          apiStatusText.textContent = 'API offline';
          
          // Remover iframe
          if (iframe.parentNode) {
            document.body.removeChild(iframe);
          }
          
          // Adicionar bot√£o de retry
          addRetryButton();
          
          // Inicializar de qualquer forma para permitir uso offline
          loadDefaultData();
        };
        
        // Configurar URL do iframe
        iframe.src = `${API_BASE_URL}/api/status?iframe=true&_=${Date.now()}`;
        
        // Adicionar iframe ao documento
        document.body.appendChild(iframe);
      }
      
      // Carregar dados padr√£o para opera√ß√£o offline
      function loadDefaultData() {
        console.log('Carregando dados padr√£o para opera√ß√£o offline');
        // A funcionalidade de caixas foi removida
      }
      
      // Fun√ß√£o para adicionar bot√£o de retry
      function addRetryButton() {
        // Apenas adicionar se n√£o existir
        if (!document.getElementById('api-status-retry-btn')) {
          const retryButton = document.createElement('button');
          retryButton.textContent = 'Reconectar';
          retryButton.id = 'api-status-retry-btn';
          retryButton.style.marginLeft = '8px';
          retryButton.style.padding = '2px 6px';
          retryButton.style.fontSize = '0.8rem';
          retryButton.style.backgroundColor = 'rgba(255,255,255,0.1)';
          retryButton.style.border = '1px solid rgba(255,255,255,0.3)';
          retryButton.style.borderRadius = '2px';
          retryButton.style.color = 'var(--cs2-text-light)';
          retryButton.style.cursor = 'pointer';
          
          retryButton.addEventListener('click', () => {
            apiStatusText.textContent = 'Reconectando...';
            // Remover o bot√£o ao tentar novamente
            if (retryButton.parentNode) {
              retryButton.parentNode.removeChild(retryButton);
            }
            // Tentar novamente ap√≥s 500ms
            setTimeout(checkApiStatus, 500);
          });
          
          if (apiStatusText && apiStatusText.parentNode) {
            apiStatusText.parentNode.appendChild(retryButton);
          }
        }
      }
      
      // Verificar estado de autentica√ß√£o
      function checkAuthStatus() {
        if (authToken) {
          // Mostrar elementos de usu√°rio logado
          if (loginBtn) loginBtn.style.display = 'none';
          if (logoutBtn) logoutBtn.style.display = 'inline-block';
          if (userInfo) userInfo.style.display = 'block';
          // N√£o mostrar o storageUnitSwitch aqui - ser√° mostrado apenas quando o usu√°rio estiver analisando seu pr√≥prio invent√°rio
          if (document.getElementById('my-inventory-btn-container')) document.getElementById('my-inventory-btn-container').style.display = 'block';
          
          // Atualizar informa√ß√µes do usu√°rio se dispon√≠veis
          try {
            const tokenData = JSON.parse(atob(authToken.split('.')[1]));
            if (userInfo && tokenData.steamid) {
              userInfo.textContent = `SteamID: ${tokenData.steamid}`;
            }
          } catch (e) {
            console.error('Erro ao decodificar token:', e);
          }
        } else {
          // Mostrar elementos para usu√°rio n√£o logado
          if (loginBtn) loginBtn.style.display = 'inline-block';
          if (logoutBtn) logoutBtn.style.display = 'none';
          if (userInfo) userInfo.style.display = 'none';
          if (document.getElementById('my-inventory-btn-container')) document.getElementById('my-inventory-btn-container').style.display = 'none';
        }
      }
      
      // Adicionar elementos para indicador de redirecionamento
      const createRedirectIndicator = () => {
        // Remover se j√° existir
        const existingIndicator = document.getElementById('redirect-indicator');
        if (existingIndicator) {
          document.body.removeChild(existingIndicator);
        }
        
        // Criar overlay
        const indicator = document.createElement('div');
        indicator.id = 'redirect-indicator';
        indicator.style.position = 'fixed';
        indicator.style.top = '0';
        indicator.style.left = '0';
        indicator.style.width = '100%';
        indicator.style.height = '100%';
        indicator.style.backgroundColor = 'rgba(10, 14, 18, 0.85)';
        indicator.style.display = 'flex';
        indicator.style.flexDirection = 'column';
        indicator.style.alignItems = 'center';
        indicator.style.justifyContent = 'center';
        indicator.style.zIndex = '9999';
        
        // Criar spinner
        const spinner = document.createElement('div');
        spinner.style.border = '6px solid rgba(255, 215, 0, 0.1)';
        spinner.style.borderLeft = '6px solid var(--cs2-primary-gold)';
        spinner.style.borderRadius = '50%';
        spinner.style.width = '50px';
        spinner.style.height = '50px';
        spinner.style.animation = 'spin 1s linear infinite';
        
        // Criar mensagem
        const message = document.createElement('div');
        message.textContent = 'Redirecionando para a Steam...';
        message.style.color = 'var(--cs2-text-light)';
        message.style.marginTop = '20px';
        message.style.fontFamily = 'Rajdhani, sans-serif';
        message.style.fontSize = '1.2rem';
        
        // Criar subtexto
        const subtext = document.createElement('div');
        subtext.textContent = 'Aguarde enquanto voc√™ √© redirecionado para autentica√ß√£o';
        subtext.style.color = 'rgba(255, 255, 255, 0.6)';
        subtext.style.marginTop = '10px';
        subtext.style.fontFamily = 'Rajdhani, sans-serif';
        subtext.style.fontSize = '0.9rem';
        
        // Bot√£o para cancelar
        const cancelBtn = document.createElement('button');
        cancelBtn.textContent = 'Cancelar';
        cancelBtn.style.marginTop = '20px';
        cancelBtn.style.padding = '8px 16px';
        cancelBtn.style.backgroundColor = 'rgba(221, 51, 51, 0.2)';
        cancelBtn.style.border = '1px solid var(--cs2-danger-red)';
        cancelBtn.style.color = 'var(--cs2-danger-red)';
        cancelBtn.style.borderRadius = '4px';
        cancelBtn.style.fontFamily = 'Rajdhani, sans-serif';
        cancelBtn.style.cursor = 'pointer';
        
        cancelBtn.addEventListener('click', () => {
          document.body.removeChild(indicator);
          // Resetar o bot√£o de login
          if (loginBtn) {
            loginBtn.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; width: 100%;"><img src="./images/steam.png" alt="Steam" style="height: 20px; width: 20px; display: block; margin-right: 10px;"><span style="display: block;">LOGIN COM STEAM</span></div>';
            loginBtn.disabled = false;
          }
        });
        
        // Montar elementos
        indicator.appendChild(spinner);
        indicator.appendChild(message);
        indicator.appendChild(subtext);
        indicator.appendChild(cancelBtn);
        
        // Adicionar ao corpo do documento
        document.body.appendChild(indicator);
        
        // Configurar remo√ß√£o autom√°tica ap√≥s 20 segundos (caso algo d√™ errado)
        setTimeout(() => {
          if (document.body.contains(indicator)) {
            document.body.removeChild(indicator);
          }
        }, 20000);
        
        return indicator;
      };
      
      // Iniciar login com Steam
      function loginWithSteam() {
        // Mostrar feedback visual - estamos adicionando um indicador de carregamento
        if (loginBtn) {
          loginBtn.innerHTML = '<div style="display: inline-flex; align-items: center; justify-content: center; width: 100%;"><div style="display: inline-block; border: 2px solid rgba(255,255,255,0.3); border-left: 2px solid var(--cs2-primary-gold); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; margin-right: 8px;"></div> CONECTANDO...</div>';
          loginBtn.disabled = true;
        }
        
        // Detectar se estamos em ambiente local e enviar o par√¢metro para a API
        const isLocalhost = window.location.hostname === 'localhost' || 
                             window.location.hostname === '127.0.0.1' ||
                             window.location.protocol === 'file:';
        
        console.log('Informa√ß√µes do ambiente:');
        console.log('- protocol:', window.location.protocol);
        console.log('- hostname:', window.location.hostname);
        console.log('- port:', window.location.port);
        console.log('- pathname:', window.location.pathname);
        console.log('- isLocalhost detectado:', isLocalhost);
        
        // Construir URL com par√¢metro de redirecionamento se for localhost
        let authUrl = `${API_BASE_URL}/auth/steam`;
        if (isLocalhost) {
          // For√ßar a URL de retorno para ser sempre http://localhost:5500/api.html
          const returnUrl = 'http://localhost:5500/api.html';
          
          authUrl += `?redirect_local=true&return_url=${encodeURIComponent(returnUrl)}`;
          console.log('URL de retorno for√ßada para:', returnUrl);
        }
        
        console.log(`Iniciando login com Steam. URL: ${authUrl}`);
        
        // Mostrar indicador visual de redirecionamento
        createRedirectIndicator();
        
        // Timeout de seguran√ßa caso a redire√ß√£o n√£o ocorra
        setTimeout(() => {
          window.location.href = authUrl;
        }, 1000);
      }
      
      // Logout
      function logout() {
        localStorage.removeItem('steamAuthToken');
        authToken = null;
        checkAuthStatus();
      }
      
      // Processar par√¢metros da URL (para callback de auth)
      function processUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        
        console.log('Verificando par√¢metros de URL ap√≥s redirecionamento');
        console.log('- URL completa:', window.location.href);
        console.log('- Hostname:', window.location.hostname);
        console.log('- Porto:', window.location.port);
        console.log('- Par√¢metros de URL:', window.location.search);
        console.log('- Token detectado:', token ? 'Sim' : 'N√£o');
        
        if (token) {
          console.log('- Token obtido, armazenando no localStorage');
          
          try {
            // Verificar se o token √© v√°lido (formato JWT)
            const tokenParts = token.split('.');
            if (tokenParts.length !== 3) {
              console.error('Formato de token inv√°lido');
              alert('O token de autentica√ß√£o parece ser inv√°lido. Por favor, tente fazer login novamente.');
              return;
            }
            
            // Decodificar payload para verificar estrutura
            try {
              const payload = JSON.parse(atob(tokenParts[1]));
              console.log('- Payload do token decodificado:', payload);
              
              // Verificar se cont√©m informa√ß√µes essenciais
              if (!payload.steam_id && !payload.exp) {
                console.warn('Token n√£o cont√©m informa√ß√µes essenciais (steam_id e exp)');
              }
              
              // Verificar se o token est√° expirado
              if (payload.exp && payload.exp < Math.floor(Date.now() / 1000)) {
                console.error('Token expirado');
                alert('Seu token de autentica√ß√£o expirou. Por favor, fa√ßa login novamente.');
                return;
              }
            } catch (e) {
              console.warn('N√£o foi poss√≠vel decodificar o payload do token, mas continuando mesmo assim', e);
            }
            
            // Armazenar o token
            localStorage.setItem('steamAuthToken', token);
            authToken = token;
            
            // Resetar bot√£o de login se ainda estiver no estado de loading
            if (loginBtn) {
              loginBtn.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; width: 100%;"><img src="./images/steam.png" alt="Steam" style="height: 20px; width: 20px; display: block; margin-right: 10px;"><span style="display: block;">LOGIN COM STEAM</span></div>';
              loginBtn.disabled = false;
            }
            
            // Atualizar UI para mostrar que o usu√°rio est√° logado
            checkAuthStatus();
            
            // Verifica√ß√£o de token com a API removida - n√£o necess√°ria
            
            // Limpar par√¢metros da URL sem recarregar a p√°gina
            const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
            window.history.replaceState({path: newUrl}, '', newUrl);
            
            console.log('- Redirecionamento para autentica√ß√£o conclu√≠do com sucesso');
          } catch (error) {
            console.error('Erro ao processar token:', error);
            localStorage.removeItem('steamAuthToken');
            authToken = null;
            checkAuthStatus();
          }
        }
        
        // Verificar outros par√¢metros
        const errorParam = urlParams.get('error');
        if (errorParam) {
          console.error('Erro de autentica√ß√£o:', errorParam);
          alert(`Ocorreu um erro durante a autentica√ß√£o: ${errorParam}`);
          
          // Limpar par√¢metros da URL
          const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
          window.history.replaceState({path: newUrl}, '', newUrl);
        }
      }
      
      // Fun√ß√£o para verificar token com a API - removida por ser desnecess√°ria
      function verifyTokenWithApi(token) {
        console.log('Verifica√ß√£o de token com API foi desativada');
        // Fun√ß√£o mantida apenas por compatibilidade, mas n√£o faz nada
        // A verifica√ß√£o de token √© feita localmente
      }
      
      // Atualizar informa√ß√µes do usu√°rio com dados da Steam
      function updateUserInfo(steamInfo) {
        if (!userInfo) return;
        
        // Mostrar informa√ß√µes mais amig√°veis
        if (steamInfo.personaname) {
          userInfo.innerHTML = `
            <div style="display: flex; align-items: center;">
              ${steamInfo.avatar ? `<img src="${steamInfo.avatar}" alt="Avatar" style="width: 24px; height: 24px; border-radius: 50%; margin-right: 10px;">` : ''}
              <div>
                <div style="font-weight: 600;">${steamInfo.personaname}</div>
                <div style="font-size: 0.8rem; opacity: 0.7;">SteamID: ${steamInfo.steamid}</div>
              </div>
            </div>
          `;
        } else {
          userInfo.textContent = `SteamID: ${steamInfo.steamid || 'Desconhecido'}`;
        }
      }
      

      
      // Formatar valor para BRL
      function formatCurrency(value) {
        return new Intl.NumberFormat('pt-BR', { 
          style: 'currency', 
          currency: 'BRL' 
        }).format(value);
      }
      
      // Fun√ß√£o vazia para caixas (mantida para compatibilidade)
      function loadCases() {
        console.log('Funcionalidade de caixas foi removida');
        // Esta fun√ß√£o est√° mantida apenas por compatibilidade
      }
      
      // Fun√ß√£o para exportar dados para Excel
      function exportToExcel(data, filename = 'inventario_elite_skins') {
        if (!data || !data.items || data.items.length === 0) {
          alert('Nenhum dado dispon√≠vel para exportar');
          return;
        }
        
        console.log('Preparando exporta√ß√£o para Excel...');
        
        // Criar uma workbook XLSX
        const wb = XLSX.utils.book_new();
        
        // Preparar os dados para a planilha principal de itens
        const itemsData = [
          // Cabe√ßalho
          ["Nome", "Hash de Mercado", "Pre√ßo (R$)", "Quantidade", "Total (R$)", "Origem", "Categoria", "Desgaste"]
        ];
        
        // Adicionar dados dos itens
        data.items.forEach(item => {
          itemsData.push([
            item.name || '',
            item.market_hash_name || '',
            (item.price || 0).toFixed(2).replace('.', ','),
            item.quantity || 1,
            (item.total || item.price || 0).toFixed(2).replace('.', ','),
            item.source === 'storage_unit' ? 'Unidade de Armazenamento' : 'Invent√°rio',
            item.category || 'Outros',
            item.exterior || ''
          ]);
        });
        
        // Criar uma planilha para os itens
        const wsItems = XLSX.utils.aoa_to_sheet(itemsData);
        
        // Adicionar a planilha ao workbook
        XLSX.utils.book_append_sheet(wb, wsItems, "Itens");
        
        // Criar uma planilha para o resumo
        const summaryData = [
          ["Resumo do Invent√°rio", ""],
          ["Total de Itens", data.total_items || 0],
          ["Valor Total (R$)", (data.total_value || 0).toFixed(2).replace('.', ',')],
          ["Valor M√©dio por Item (R$)", (data.average_item_value || 0).toFixed(2).replace('.', ',')]
        ];
        
        // Adicionar informa√ß√µes de fonte se dispon√≠vel
        if (data.source_summary) {
          summaryData.push(["", ""]);
          summaryData.push(["Resumo por Origem", ""]);
          summaryData.push(["Itens de Unidades", data.source_summary.storage_units?.count || 0]);
          summaryData.push(["Valor em Unidades (R$)", (data.source_summary.storage_units?.value || 0).toFixed(2).replace('.', ',')]);
          summaryData.push(["Itens de Invent√°rio", data.source_summary.market?.count || 0]);
          summaryData.push(["Valor em Invent√°rio (R$)", (data.source_summary.market?.value || 0).toFixed(2).replace('.', ',')]);
        }
        
        // Adicionar data e hora da exporta√ß√£o
        const now = new Date();
        const dateStr = now.toLocaleDateString('pt-BR');
        const timeStr = now.toLocaleTimeString('pt-BR');
        summaryData.push(["", ""]);
        summaryData.push([`Exportado em: ${dateStr} √†s ${timeStr} | Elite Skins 2025`, ""]);
        
        // Criar uma planilha para o resumo
        const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
        
        // Adicionar a planilha de resumo ao workbook
        XLSX.utils.book_append_sheet(wb, wsSummary, "Resumo");
        
        // Gerar o arquivo XLSX e acionar o download
        XLSX.writeFile(wb, `${filename}_${dateStr.replace(/\//g, '-')}.xlsx`);
        
        console.log('Exporta√ß√£o para Excel conclu√≠da');
      }
      
      // Altern√¢ncia de tabs
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class de todas as tabs
          tabs.forEach(t => {
            t.classList.remove('active');
            t.style.color = 'var(--cs2-text-light)';
          });
          
          // Adiciona active class na tab clicada
          tab.classList.add('active');
          tab.style.color = 'var(--cs2-primary-gold)';
          
          // Esconde todos os conte√∫dos
          tabContents.forEach(content => {
            content.style.display = 'none';
          });
          
          // Mostra o conte√∫do da tab selecionada
          const tabId = tab.getAttribute('data-tab');
          document.getElementById(`${tabId}-tab`).style.display = 'block';
        });
      });
      
      // Criar cart√£o de item
      function createItemCard(item) {
        // Adicionar badge de filtragem se aplic√°vel
        const filteredBadge = item.filtered ? 
          `<span style="font-size: 0.7rem; background: rgba(75,158,42,0.2); color: var(--cs2-accent-green); display: inline-block; padding: 1px 4px; border-radius: 3px; margin-left: 5px;">ajustado</span>` : '';
        
        // Badge para indicar m√∫ltiplas fontes de pre√ßo
        const sourcesBadge = item.price_sources_count ? 
          `<span style="font-size: 0.7rem; background: rgba(35,137,218,0.2); color: var(--cs2-info-blue); display: inline-block; padding: 1px 4px; border-radius: 3px; margin-left: 5px;">${item.price_sources_count} fontes</span>` : '';
        
        return `
          <div style="display: flex; align-items: center; margin-bottom: 15px; padding: 10px; background: rgba(19,30,43,0.5); border-radius: 6px; border-left: 3px solid ${getRarityColor(item.rarity)};">
            <div style="flex: 1;">
              <div style="font-weight: 600; color: ${getRarityColor(item.rarity)};">
                ${item.name}
                ${filteredBadge}
                ${sourcesBadge}
              </div>
              <div style="font-size: 0.9rem; opacity: 0.7;">${item.type || ''} | ${item.exterior || ''}</div>
              ${item.source ? `<div style="font-size: 0.8rem; background: rgba(255,215,0,0.1); display: inline-block; padding: 2px 6px; border-radius: 3px; margin-top: 4px;">${item.source === 'storage_unit' ? 'Unidade de Armazenamento' : 'Invent√°rio'}</div>` : ''}
            </div>
            <div style="font-weight: 700; color: var(--cs2-accent-orange);">${formatCurrency(item.price || 0)}</div>
          </div>
        `;
      }
      
      // Criar cart√£o de unidade de armazenamento
      function createStorageUnitCard(unit) {
        return `
          <div style="margin-bottom: 20px; padding: 15px; background: rgba(19,30,43,0.8); border-radius: 8px; border: 1px solid rgba(255,215,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <h4 style="font-family: 'Orbitron', sans-serif; color: var(--cs2-primary-gold); margin: 0; font-size: 1.1rem;">${unit.unit_info?.name || 'Unidade de Armazenamento'}</h4>
              <span style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-accent-orange); font-weight: 700; font-size: 1.2rem;">${formatCurrency(unit.contents?.total_value || 0)}</span>
            </div>
            <div style="font-size: 0.9rem; margin-bottom: 10px;">
              <span style="color: var(--cs2-text-light); opacity: 0.8;">Total de itens: ${unit.contents?.total_items || 0}</span>
            </div>
            <div style="margin-top: 10px;">
              ${unit.contents?.items?.slice(0, 3).map(item => createItemCard(item)).join('') || ''}
              ${unit.contents?.items?.length > 3 ? `<div style="text-align: center; padding: 5px; font-size: 0.9rem; color: var(--cs2-text-light); opacity: 0.7;">+ ${unit.contents.items.length - 3} itens adicionais</div>` : ''}
            </div>
          </div>
        `;
      }
      
      // Obter cor com base na raridade
      function getRarityColor(rarity) {
        const rarityColors = {
          'Consumer Grade': '#b0c3d9',
          'Industrial Grade': '#5e98d9',
          'Mil-Spec Grade': '#4b69ff',
          'Restricted': '#8847ff',
          'Classified': '#d32ce6',
          'Covert': '#eb4b4b',
          'Knife': '#caab05',
          'Extraordinary': '#caab05'
        };
        
        return rarityColors[rarity] || 'var(--cs2-primary-gold)';
      }
      
      // Analisar invent√°rio (para o bot√£o da interface) - Fun√ß√£o mantida para compatibilidade
      function analyzeInventory() {
        // Exibir mensagem para o usu√°rio
        inventoryResult.style.opacity = '1';
        inventoryLoading.style.display = 'none';
        inventoryData.style.display = 'block';
        
        // Exibir mensagem explicativa
        inventorySummary.innerHTML = `
          <div style="text-align: center; padding: 20px; background: rgba(19,30,43,0.7); border-radius: 8px; border-left: 3px solid var(--cs2-primary-gold);">
            <p style="font-size: 1.1rem; margin-bottom: 10px; color: var(--cs2-primary-gold);">
              <strong>Funcionalidade Atualizada</strong>
            </p>
            <p style="color: var(--cs2-text-light); margin-bottom: 15px;">
              A an√°lise de invent√°rio de terceiros foi descontinuada. 
              Para verificar um invent√°rio, fa√ßa login com sua conta Steam.
            </p>
            <button id="redirect-login-btn" class="btn" style="padding: 8px 20px; background: linear-gradient(135deg, #2f526f 0%, #1c2838 100%); color: var(--cs2-text-light); border: none; border-radius: 4px; font-family: 'Rajdhani', sans-serif; font-size: 1rem; cursor: pointer;">
              <img src="./images/steam.png" alt="Steam" style="height: 16px; width: 16px; display: inline-block; vertical-align: middle; margin-right: 8px;">
              Login com Steam
            </button>
          </div>
        `;
        
        inventoryItems.innerHTML = '';
        
        // Adicionar event listener para o bot√£o de redirecionamento
        setTimeout(() => {
          const redirectBtn = document.getElementById('redirect-login-btn');
          if (redirectBtn) {
            redirectBtn.addEventListener('click', loginWithSteam);
          }
        }, 100);
      }
      
      // Fun√ß√£o auxiliar para criar URL com proxy CORS
      function createCorsProxyUrl(originalUrl) {
        const corsProxyUrl = 'https://corsproxy.io/?';
        return `${corsProxyUrl}${encodeURIComponent(originalUrl)}`;
      }
      
      // Fun√ß√£o para formatar moeda original baseada na moeda
      function formatOriginalCurrency(price, currency) {
        if (!price) return '0.00';
        price = parseFloat(price);
        
        const symbols = {
          'USD': '$',
          'EUR': '‚Ç¨',
          'GBP': '¬£',
          'BRL': 'R$'
        };
        
        const symbol = symbols[currency] || '$';
        return `${symbol}${price.toFixed(2)}`;
      }
      
      // Buscar pre√ßo com m√©todo de fallback
      async function getPrice() {
        const skinName = skinNameInput.value.trim();
        if (!skinName) {
          alert('Por favor, informe o nome da skin.');
          return;
        }
        
        priceResult.style.opacity = '1';
        priceLoading.style.display = 'block';
        priceData.style.display = 'none';
        
        console.log('Buscando pre√ßo para:', skinName);
        
        try {
          // Garantir que temos a taxa de c√¢mbio atualizada
          await getExchangeRate();
          
          // Corre√ß√£o: Usar par√¢metro de caminho em vez de par√¢metro de consulta
          const endpoint = `${API_BASE_URL}/price/${encodeURIComponent(skinName)}`;
          console.log('Fazendo requisi√ß√£o para:', endpoint);
          
          // Tentar fazer a requisi√ß√£o para a API
          const response = await fetch(endpoint, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'Content-Type': 'application/json',
              'Cache-Control': 'no-cache'
            },
            mode: 'cors',
            cache: 'no-cache'
          });
          
          // Verificar se a resposta foi bem-sucedida
          if (!response || !response.ok) {
            throw new Error('Erro ao consultar a API: ' + (response ? `Status ${response.status}` : 'Conex√£o falhou'));
          }
          
          let data;
          let pricesData = null;
          let filteredPrice = null;
          let hasMultiplePrices = false;
          
          // Processar os dados da API
          data = await response.json();
          console.log('Pre√ßo obtido da API:', data);
          
          // Verificar se o pre√ßo existe nos dados retornados
          if (!data || !data.price) {
            throw new Error('API n√£o retornou um pre√ßo v√°lido');
          }
          
          // Armazenar informa√ß√µes da moeda original
          data.original_price = data.price;
          data.original_currency = data.currency || "USD";
          
          // Verificar se temos m√∫ltiplos pre√ßos para filtrar outliers
          if (data.prices && Array.isArray(data.prices) && data.prices.length > 0) {
            hasMultiplePrices = true;
            pricesData = data.prices;
            
            // Converter para valores num√©ricos
            const priceValues = data.prices.map(p => p.price || 0);
            
            // Aplicar o filtro de outliers
            filteredPrice = filterOutliersAndCalculateAverage(priceValues);
            console.log('Pre√ßo filtrado calculado:', filteredPrice);
            
            // Atualizar o pre√ßo com o valor filtrado
            data.price = filteredPrice.toFixed(2);
            data.filtered = true;
          }
          
          // Converter pre√ßo para BRL se a moeda original n√£o for BRL
          if (data.original_currency !== 'BRL') {
            data.price_brl = (parseFloat(data.price) * CURRENCY_RATES.USD_to_BRL * STEAM_TAX_FACTOR).toFixed(2);
          } else {
            data.price_brl = data.price;
          }
          
          // Converter tamb√©m os pre√ßos individuais se existirem
          if (pricesData) {
            pricesData = pricesData.map(p => {
              if (p.price) {
                p.original_price_usd = p.price;
                if (data.original_currency !== 'BRL') {
                  p.price = (parseFloat(p.price) * CURRENCY_RATES.USD_to_BRL * STEAM_TAX_FACTOR).toFixed(2);
                }
              }
              return p;
            });
          }
          
          // Mostrar resultado
          let priceInfoHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem;">
              <span>Nome da Skin:</span>
              <span style="font-weight: 600; color: var(--cs2-primary-gold);">${data.market_hash_name || skinName}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem;">
              <span>Pre√ßo Original (${data.original_currency}):</span>
              <span style="font-weight: 600; color: var(--cs2-info-blue);">${formatOriginalCurrency(data.original_price, data.original_currency)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem;">
              <span>Pre√ßo em BRL:</span>
              <span style="font-weight: 700; color: var(--cs2-accent-orange); font-size: 1.3rem;">${formatCurrency(parseFloat(data.price_brl))}</span>
            </div>`;
          
          // Adicionar informa√ß√µes sobre filtragem se aplic√°vel
          if (hasMultiplePrices && pricesData) {
            priceInfoHTML += `
              <div style="margin-top: 15px; padding: 10px; background: rgba(26,38,52,0.5); border-radius: 6px; border: 1px solid rgba(255,215,0,0.2);">
                <h4 style="font-family: 'Rajdhani', sans-serif; color: var(--cs2-primary-gold); margin-bottom: 10px; font-size: 1rem; display: flex; align-items: center;">
                  <span style="display: inline-block; width: 6px; height: 6px; background: var(--cs2-accent-green); border-radius: 50%; margin-right: 5px;"></span>
                  An√°lise de Pre√ßos (${pricesData.length} fontes)
                </h4>
                <div style="max-height: 200px; overflow-y: auto; padding-right: 10px;">`;
                
            // Ordenar pre√ßos do menor para o maior
            pricesData.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
            
            // Calcular a mediana para identificar outliers visualmente
            const priceValues = pricesData.map(p => parseFloat(p.price));
            const median = priceValues.length % 2 === 0
              ? (priceValues[priceValues.length / 2 - 1] + priceValues[priceValues.length / 2]) / 2
              : priceValues[Math.floor(priceValues.length / 2)];
            
            // Definir limite percentual para destacar outliers (40%)
            const percentLimit = 0.4;
            const upperVisualLimit = median * (1 + percentLimit);
            const lowerVisualLimit = median * (1 - percentLimit);
            
            // Adicionar cada pre√ßo com indicador de outlier
            pricesData.forEach((priceItem, index) => {
              const priceValue = parseFloat(priceItem.price);
              const isOutlier = priceValue < lowerVisualLimit || priceValue > upperVisualLimit;
              
              priceInfoHTML += `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px; padding: 5px; border-radius: 4px; ${isOutlier ? 'background: rgba(221,51,51,0.1);' : ''}">
                  <span style="color: ${isOutlier ? 'var(--cs2-danger-red)' : 'var(--cs2-text-light)'}; font-size: 0.9rem;">
                    ${priceItem.source || `Fonte ${index + 1}`}
                    ${isOutlier ? ' <span style="color: var(--cs2-danger-red); font-size: 0.8rem;">(outlier)</span>' : ''}
                  </span>
                  <span style="font-weight: 600; color: ${isOutlier ? 'var(--cs2-danger-red)' : 'var(--cs2-accent-orange)'}; font-size: 0.9rem;">
                    ${formatCurrency(priceValue)}
                  </span>
                </div>`;
            });
            
            priceInfoHTML += `</div></div>`;
          }
          
          // Adicionar informa√ß√µes sobre taxas e origem
          priceInfoHTML += `
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-family: 'Rajdhani', sans-serif; color: var(--cs2-text-light); font-size: 0.9rem; text-align: center;">
              <p>Pre√ßo ${data.filtered ? 'm√©dio ajustado' : 'obtido'} do Mercado Steam com convers√£o para BRL.</p>
              <p style="margin-top: 5px; font-size: 0.8rem; opacity: 0.7;">Taxa de convers√£o atual: 1 USD = ${CURRENCY_RATES.USD_to_BRL.toFixed(2)} BRL</p>
              <p style="margin-top: 5px; font-size: 0.8rem; opacity: 0.7;">√öltima atualiza√ß√£o: ${new Date().toLocaleString('pt-BR')}</p>
            </div>
          `;
          
          // Atualizar o elemento com as informa√ß√µes
          priceInfo.innerHTML = priceInfoHTML;
          
          // Esconder loading e mostrar dados
          priceLoading.style.display = 'none';
          priceData.style.display = 'block';
          
        } catch (error) {
          console.error('Erro ao buscar pre√ßo:', error);
          
          // Exibir mensagem de erro sem simula√ß√£o de pre√ßo
          priceInfo.innerHTML = `
            <div style="text-align: center; padding: 20px; background: rgba(221,51,51,0.1); border-radius: 6px;">
              <p style="color: var(--cs2-danger-red); font-weight: 600; font-size: 1.2rem; margin-bottom: 10px;">Pre√ßo n√£o dispon√≠vel</p>
              <p style="color: var(--cs2-text-light);">N√£o foi poss√≠vel obter o pre√ßo atual desta skin no mercado Steam.</p>
              <p style="color: var(--cs2-text-light); margin-top: 10px; font-size: 0.9rem;">${error.message || 'Erro de conex√£o com o mercado Steam'}</p>
              <div style="margin-top: 15px;">
                <a href="https://steamcommunity.com/market/search?q=${encodeURIComponent(skinName)}" target="_blank" style="color: var(--cs2-info-blue); text-decoration: underline;">Verificar diretamente no mercado Steam</a>
              </div>
            </div>
          `;
          
          // Esconder loading e mostrar dados
          priceLoading.style.display = 'none';
          priceData.style.display = 'block';
        }
      }
      
      // Fun√ß√£o de fallback para simular pre√ßos (usado quando a API n√£o est√° dispon√≠vel)
      function simulatePriceFallback(skinName) {
        // Fontes comuns de pre√ßos de CS2 para simula√ß√£o
        const sourcesNames = [
          "Steam Market", 
          "Steam Community", 
          "CS.Money", 
          "SkinBaron", 
          "SkinPort", 
          "Buff163", 
          "BitSkins", 
          "DMarket", 
          "SkinWallet"
        ];
        
        // Valores aproximados baseados em experi√™ncia de mercado (mais realistas)
        const prices = {
          "AWP | Asiimov (Field-Tested)": [80.45, 82.30, 79.98, 81.50],
          "AK-47 | Redline (Field-Tested)": [11.55, 12.00, 11.85, 11.45],
          "M4A4 | Desolate Space (Factory New)": [25.75, 24.99, 25.50, 26.20],
          "StatTrak‚Ñ¢ CZ75-Auto | Tacticat": [2.50, 2.65, 2.45, 2.55],
          "Desert Eagle | Blaze (Factory New)": [230.45, 235.20, 232.80, 228.50],
          "Karambit | Fade (Factory New)": [950.00, 945.50, 960.30, 952.80],
          "USP-S | Kill Confirmed (Minimal Wear)": [82.75, 84.20, 81.90, 83.50]
        };
        
        // Se o item espec√≠fico n√£o estiver na lista, mas o tipo for conhecido, fazer estimativa
        const itemType = getItemType(skinName);
        if (!prices[skinName] && itemType) {
          const basePrices = {
            "AWP": [25, 40, 70, 120],
            "AK-47": [15, 30, 60, 100],
            "M4A4": [10, 25, 50, 85],
            "M4A1-S": [12, 28, 55, 90],
            "Desert Eagle": [8, 15, 30, 60],
            "USP-S": [10, 20, 40, 70],
            "Glock-18": [8, 18, 35, 60],
            "Knife": [90, 200, 350, 600],
            "Gloves": [70, 150, 300, 500],
            "StatTrak‚Ñ¢": [1.5, 2, 3, 0] // multiplicador
          };
          
          // Gerar pre√ßo base pelo tipo
          let basePrice = 5; // valor base m√≠nimo
          if (basePrices[itemType]) {
            // Selecionar faixa de pre√ßo pela qualidade
            let qualityIndex = 0;
            if (skinName.includes("Factory New")) qualityIndex = 3;
            else if (skinName.includes("Minimal Wear")) qualityIndex = 2;
            else if (skinName.includes("Field-Tested")) qualityIndex = 1;
            else qualityIndex = 0;
            
            basePrice = basePrices[itemType][qualityIndex];
          }
          
          // Ajustar para StatTrak
          if (skinName.includes("StatTrak‚Ñ¢") && basePrices["StatTrak‚Ñ¢"]) {
            const stMultiplier = basePrices["StatTrak‚Ñ¢"][Math.floor(Math.random() * 3)];
            basePrice *= stMultiplier;
          }
          
          // Gerar varia√ß√µes para simular fontes diferentes (varia√ß√£o realista de 1-5%)
          const basePriceUSD = basePrice;
          const variations = [];
          
          // Gerar pre√ßos para 4-6 fontes aleat√≥rias
          const numSources = 4 + Math.floor(Math.random() * 3);
          const selectedSources = [...sourcesNames].sort(() => 0.5 - Math.random()).slice(0, numSources);
          
          selectedSources.forEach((source, idx) => {
            const variation = (Math.random() * 0.08) - 0.04; // -4% a +4%
            variations.push({
              source: source,
              price: (basePriceUSD * (1 + variation)).toFixed(2)
            });
          });
          
          // Aplicar filtro de outliers aos valores
          const priceValues = variations.map(v => parseFloat(v.price));
          const filteredPrice = filterOutliersAndCalculateAverage(priceValues);
          
          return {
            market_hash_name: skinName,
            price: filteredPrice.toFixed(2),
            prices: variations,
            filtered: variations.length > 3,
            offline_mode: true
          };
        }
        
        // Se temos pre√ßos predefinidos para o item, us√°-los com nomes de fontes
        if (prices[skinName]) {
          // Escolher 4-6 fontes aleat√≥rias
          const numSources = Math.min(prices[skinName].length, 4 + Math.floor(Math.random() * 3));
          const selectedSources = [...sourcesNames].sort(() => 0.5 - Math.random()).slice(0, numSources);
          
          // Associar pre√ßos com fontes
          const variations = [];
          for (let i = 0; i < numSources; i++) {
            variations.push({
              source: selectedSources[i],
              price: prices[skinName][i % prices[skinName].length].toFixed(2)
            });
          }
          
          // Aplicar filtro de outliers
          const priceValues = variations.map(v => parseFloat(v.price));
          const filteredPrice = filterOutliersAndCalculateAverage(priceValues);
          
          return {
            market_hash_name: skinName,
            price: filteredPrice.toFixed(2),
            prices: variations,
            filtered: variations.length > 3,
            offline_mode: true
          };
        }
        
        // Pre√ßos padr√£o para skins n√£o conhecidas
        const basePrice = 5 + Math.random() * 20;
        const variations = [];
        
        // Gerar pre√ßos para 4-6 fontes aleat√≥rias
        const numSources = 4 + Math.floor(Math.random() * 3);
        const selectedSources = [...sourcesNames].sort(() => 0.5 - Math.random()).slice(0, numSources);
        
        selectedSources.forEach(source => {
          const variation = (Math.random() * 0.08) - 0.04; // -4% a +4%
          variations.push({
            source: source,
            price: (basePrice * (1 + variation)).toFixed(2)
          });
        });
        
        // Aplicar filtro de outliers
        const priceValues = variations.map(v => parseFloat(v.price));
        const filteredPrice = filterOutliersAndCalculateAverage(priceValues);
        
        return {
          market_hash_name: skinName,
          price: filteredPrice.toFixed(2),
          prices: variations,
          filtered: variations.length > 3,
          offline_mode: true
        };
      }
      
      // Fun√ß√£o auxiliar para determinar o tipo de item a partir do nome
      function getItemType(skinName) {
        const typeChecks = [
          { pattern: /AWP/i, type: "AWP" },
          { pattern: /AK-47/i, type: "AK-47" },
          { pattern: /M4A4/i, type: "M4A4" },
          { pattern: /M4A1-S/i, type: "M4A1-S" },
          { pattern: /Desert Eagle|Deagle/i, type: "Desert Eagle" },
          { pattern: /USP-S/i, type: "USP-S" },
          { pattern: /Glock-18/i, type: "Glock-18" },
          { pattern: /Knife|Karambit|Bayonet|Bowie|Butterfly|Daggers|Falchion|Flip|Gut|Huntsman|Navaja|Shadow|Stiletto|Talon|Ursus|Paracord|Nomad|Skeleton|Survival|Classic/i, type: "Knife" },
          { pattern: /Gloves|Wraps|Hand/i, type: "Gloves" }
        ];
        
        for (const check of typeChecks) {
          if (check.pattern.test(skinName)) {
            return check.type;
          }
        }
        
        return null;
      }
      
      // Fun√ß√£o para filtrar outliers e calcular pre√ßo m√©dio mais preciso
      function filterOutliersAndCalculateAverage(prices) {
        // Se temos menos de 3 pre√ßos, simplesmente calculamos a m√©dia
        if (!prices || prices.length < 3) {
          if (prices && prices.length > 0) {
            const sum = prices.reduce((acc, price) => acc + parseFloat(price), 0);
            return sum / prices.length;
          }
          return null;
        }
        
        // Converter para array de n√∫meros
        const priceValues = prices.map(p => typeof p === 'number' ? p : parseFloat(p));
        
        // Ordenar os pre√ßos para calcular a mediana (mais robusta que m√©dia para outliers)
        const sortedPrices = [...priceValues].sort((a, b) => a - b);
        
        // Calcular a mediana (valor central)
        const median = sortedPrices.length % 2 === 0
          ? (sortedPrices[sortedPrices.length / 2 - 1] + sortedPrices[sortedPrices.length / 2]) / 2
          : sortedPrices[Math.floor(sortedPrices.length / 2)];
        
        // Calcular desvio absoluto mediano (MAD) - medida mais robusta de dispers√£o
        const deviations = sortedPrices.map(price => Math.abs(price - median));
        deviations.sort((a, b) => a - b);
        const mad = deviations.length % 2 === 0
          ? (deviations[deviations.length / 2 - 1] + deviations[deviations.length / 2]) / 2
          : deviations[Math.floor(deviations.length / 2)];
        
        // Definir limites para detec√ß√£o de outliers
        // 1) Usando MAD com fator de escala (mais robusto para pequenos conjuntos de dados)
        const madFactor = 2.5; // Fator conservador para n√£o remover muito
        
        // 2) Usando tamb√©m um limite percentual baseado na mediana
        const percentLimit = 0.4; // 40% de desvio da mediana
        
        // Aplicar ambos os crit√©rios para ser um filtro mais preciso
        const upperLimit = Math.min(
          median + (madFactor * mad), 
          median * (1 + percentLimit)
        );
        
        const lowerLimit = Math.max(
          median - (madFactor * mad),
          median * (1 - percentLimit),
          0 // Evitar valores negativos
        );
        
        // Filtrar outliers
        const filteredPrices = priceValues.filter(price => 
          price >= lowerLimit && price <= upperLimit
        );
        
        // Se todos os pre√ßos foram filtrados, retorne a mediana
        if (filteredPrices.length === 0) {
          console.log(`Todos os pre√ßos foram considerados outliers. Usando mediana: ${median}`);
          return median;
        }
        
        // Calcular nova m√©dia sem outliers
        const filteredSum = filteredPrices.reduce((acc, price) => acc + price, 0);
        const filteredMean = filteredSum / filteredPrices.length;
        
        // Log para debug
        const outliersRemoved = priceValues.length - filteredPrices.length;
        if (outliersRemoved > 0) {
          console.log(`Pre√ßo processado: Mediana: ${median.toFixed(2)}, Pre√ßo filtrado: ${filteredMean.toFixed(2)}`);
          console.log(`Pre√ßos originais: ${priceValues.length}, Pre√ßos ap√≥s filtro: ${filteredPrices.length}, Outliers removidos: ${outliersRemoved}`);
          console.log(`Limites de filtragem: [${lowerLimit.toFixed(2)} - ${upperLimit.toFixed(2)}]`);
        }
        
        return filteredMean;
      }
      

      
      // Eventos de autentica√ß√£o
      if (loginBtn) {
        loginBtn.addEventListener('click', loginWithSteam);
      }
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', logout);
      }
      
      // Evento para analisar pr√≥prio invent√°rio
      const myInventoryBtn = document.getElementById('my-inventory-btn');
      if (myInventoryBtn) {
        myInventoryBtn.addEventListener('click', analyzeOwnInventory);
      }
      
      // Fun√ß√£o para analisar o pr√≥prio invent√°rio
      function analyzeOwnInventory() {
        if (!authToken) {
          alert('Voc√™ precisa estar logado para analisar seu pr√≥prio invent√°rio.');
          return;
        }
        
        // Exibir loading
        inventoryResult.style.opacity = '1';
        inventoryLoading.style.display = 'block';
        inventoryData.style.display = 'none';
        
        // Primeiro, garantir que temos a taxa de c√¢mbio atualizada
        getExchangeRate().then(() => {
          // Sempre usar a an√°lise completa incluindo unidades de armazenamento
          const endpoint = `${API_BASE_URL}/my/inventory/complete`;
          
          // Configura√ß√£o do cabe√ßalho de autoriza√ß√£o (certificando-se de que o token √© enviado corretamente)
          const headers = {
            'Authorization': `Bearer ${authToken.trim()}`,
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          };
          
          console.log('Token enviado:', authToken);
          console.log('Headers:', headers);
          console.log(`Fazendo requisi√ß√£o para: ${endpoint}`);
          
          // M√âTODO 1: Modificando para usar token como par√¢metro de URL
          // Adicionamos o token como par√¢metro de URL em vez de usar headers (evita preflight CORS)
          const tokenParam = encodeURIComponent(authToken);
          const urlWithToken = `${endpoint}?token=${tokenParam}`;
          
          fetch(urlWithToken, { 
            method: 'GET',
            headers: {
              'Cache-Control': 'no-cache, no-store, must-revalidate',
              'Pragma': 'no-cache',
              'Expires': '0',
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            credentials: 'same-origin',
            cache: 'no-cache',
            mode: 'cors' // Mantemos 'cors' pois estamos usando par√¢metro de URL
          })
            .then(response => {
              console.log('Status da resposta:', response.status);
              if (!response.ok) {
                return response.json().then(error => {
                  throw new Error(`Erro ${response.status}: ${error.detail || JSON.stringify(error)}`);
                });
              }
              return response.json();
            })
            .then(data => {
              console.log('Dados do invent√°rio recebidos:', data);
              
              // Aplicar fator de corre√ß√£o para BRL usando a taxa atual
              // Fun√ß√£o melhorada para aplicar fator de corre√ß√£o a um item e filtrar outliers quando h√° m√∫ltiplas fontes
              const applyPriceCorrection = (item) => {
                if (item && item.price) {
                  // Verificar se o item tem m√∫ltiplos pre√ßos
                  if (item.price_sources && Array.isArray(item.price_sources) && item.price_sources.length > 1) {
                    // Extrair os pre√ßos de diferentes fontes
                    const prices = item.price_sources.map(source => source.price || 0);
                    
                    // Usar filtro de outliers para calcular o pre√ßo ajustado
                    const filteredPrice = filterOutliersAndCalculateAverage(prices);
                    
                    // Atualizar informa√ß√µes do item
                    item.original_price = item.price;
                    item.price = filteredPrice;
                    item.filtered = true;
                    item.price_sources_count = item.price_sources.length;
                    
                    console.log(`Item filtrado: ${item.name}, Pre√ßo original: ${item.original_price}, Pre√ßo filtrado: ${item.price}`);
                  }
                  
                  const originalPrice = parseFloat(item.price);
                  // Apenas aplica a corre√ß√£o se o pre√ßo j√° n√£o estiver em BRL (verifica√ß√£o simples)
                  if (originalPrice < 100) { // Assumindo que se o pre√ßo for menor que 100, est√° em USD
                    item.price = originalPrice * CURRENCY_RATES.USD_to_BRL * STEAM_TAX_FACTOR;
                    if (item.total) {
                      item.total = item.price * (item.quantity || 1);
                    }
                    
                    // Converter tamb√©m os pre√ßos de fontes individuais, se existirem
                    if (item.price_sources && Array.isArray(item.price_sources)) {
                      item.price_sources = item.price_sources.map(source => {
                        if (source.price) {
                          source.original_price_usd = source.price;
                          source.price = parseFloat(source.price) * CURRENCY_RATES.USD_to_BRL * STEAM_TAX_FACTOR;
                        }
                        return source;
                      });
                    }
                  }
                }
                return item;
              };
              
              // Aplicar corre√ß√£o a todos os itens
              if (data.items && Array.isArray(data.items)) {
                data.items = data.items.map(applyPriceCorrection);
              }
              
              // Aplicar corre√ß√£o a todos os itens se usar unidades de armazenamento
              if (data.all_items && Array.isArray(data.all_items)) {
                data.all_items = data.all_items.map(applyPriceCorrection);
              }
              
              // Aplicar corre√ß√£o √†s unidades de armazenamento
              if (data.storage_unit_contents && Array.isArray(data.storage_unit_contents)) {
                data.storage_unit_contents.forEach(unit => {
                  if (unit.contents && unit.contents.items) {
                    unit.contents.items = unit.contents.items.map(applyPriceCorrection);
                    // Recalcular o valor total da unidade
                    unit.contents.total_value = unit.contents.items.reduce((sum, item) => sum + (item.total || item.price || 0), 0);
                  }
                });
                
                // Recalcular o valor total das unidades
                data.storage_units_content_value = data.storage_unit_contents.reduce(
                  (sum, unit) => sum + (unit.contents?.total_value || 0), 0
                );
              }
              
              // Recalcular os totais
              if (data.total_value !== undefined) {
                // Se o backend n√£o aplicou corre√ß√£o, aplicamos aqui
                if (data.total_value < 1000) { // Verifica√ß√£o simples para ver se j√° est√° em BRL
                  data.total_value = data.total_value * CURRENCY_RATES.USD_to_BRL * STEAM_TAX_FACTOR;
                }
              }
              
              if (data.grand_total_value !== undefined) {
                // Se o total j√° n√£o incluir o valor corrigido das unidades
                data.grand_total_value = data.total_value + (data.storage_units_content_value || 0);
              }
              
              // Determina qual valor total mostrar com base no tipo de resposta
              const totalValue = data.grand_total_value || data.total_value || 0;
              inventoryTotalValue.textContent = formatCurrency(totalValue);
              
              // Armazenar dados para exporta√ß√£o
              lastInventoryData = data;
              
              // Calcular estat√≠sticas de filtragem de pre√ßos
              const filteredItemsCount = data.items ? 
                data.items.filter(item => item.filtered).length : 
                (data.all_items ? data.all_items.filter(item => item.filtered).length : 0);
              
              // Preenche o resumo
              let summaryHTML = `
                <div style="margin-bottom: 1.5rem; padding: 15px; background: rgba(19,30,43,0.5); border-radius: 8px;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Total de Itens:</span>
                    <span style="font-weight: 600;">${data.total_items || 0}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Valor M√©dio por Item:</span>
                    <span style="font-weight: 600;">${formatCurrency((totalValue) / (data.total_items || 1))}</span>
                  </div>`;
                  
              // Adicionar informa√ß√µes sobre a taxa de c√¢mbio
              summaryHTML += `
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <span>Taxa USD ‚Üí BRL:</span>
                  <span style="font-weight: 600;">1 USD = ${CURRENCY_RATES.USD_to_BRL.toFixed(2)} BRL</span>
                </div>`;
                
              // Adicionar informa√ß√£o sobre itens com pre√ßos filtrados
              if (filteredItemsCount > 0) {
                summaryHTML += `
                  <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Itens com pre√ßos filtrados:</span>
                    <span style="font-weight: 600; color: var(--cs2-accent-green);">${filteredItemsCount}</span>
                  </div>`;
              }
                  
              // Adicionar informa√ß√µes sobre unidades de armazenamento se dispon√≠veis
              if (data.storage_units_content_value !== undefined) {
                summaryHTML += `
                  <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Valor em Unidades:</span>
                    <span style="font-weight: 600;">${formatCurrency(data.storage_units_content_value)}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Valor em Invent√°rio:</span>
                    <span style="font-weight: 600;">${formatCurrency(data.total_value)}</span>
                  </div>
                `;
              }
              
              // Adicionar item mais valioso se dispon√≠vel
              if (data.most_valuable_item) {
                summaryHTML += `
                  <div style="display: flex; justify-content: space-between;">
                    <span>Item Mais Valioso:</span>
                    <span style="font-weight: 600; color: var(--cs2-accent-orange);">${data.most_valuable_item?.name || 'N/A'}</span>
                  </div>
                `;
              }
              
              summaryHTML += `</div>`;
              inventorySummary.innerHTML = summaryHTML;
              
              // Preenche a lista de itens
              let itemsHTML = '<h4 style="font-family: \'Orbitron\', sans-serif; color: var(--cs2-primary-gold); margin: 1rem 0; font-size: 1.1rem;">Itens Mais Valiosos</h4>';
              
              // Determinar quais itens mostrar com base no tipo de resposta
              let itemsToShow = [];
              
              if (data.all_items && data.all_items.length > 0) {
                // Resposta da an√°lise com unidades de armazenamento
                itemsToShow = data.all_items;
              } else if (data.items && data.items.length > 0) {
                // Resposta normal
                itemsToShow = data.items;
              }
              
              // Adiciona itens se dispon√≠veis
              if (itemsToShow.length > 0) {
                itemsToShow.sort((a, b) => b.price - a.price).slice(0, 10).forEach(item => {
                  itemsHTML += createItemCard(item);
                });
              } else {
                itemsHTML += '<p style="color: var(--cs2-text-light); opacity: 0.7;">Nenhum item encontrado</p>';
              }
              
              // Adicionar se√ß√£o de unidades de armazenamento se dispon√≠vel
              if (data.storage_unit_contents && data.storage_unit_contents.length > 0) {
                itemsHTML += `
                  <h4 style="font-family: 'Orbitron', sans-serif; color: var(--cs2-primary-gold); margin: 1.5rem 0 1rem; font-size: 1.1rem; border-top: 1px solid rgba(255,215,0,0.2); padding-top: 1.5rem;">Unidades de Armazenamento</h4>
                `;
                
                data.storage_unit_contents.forEach(unit => {
                  itemsHTML += createStorageUnitCard(unit);
                });
              }
              
              inventoryItems.innerHTML = itemsHTML;
              
              // Exibe os dados
              inventoryLoading.style.display = 'none';
              inventoryData.style.display = 'block';
            })
            .catch(error => {
              console.error('Erro ao analisar invent√°rio:', error);
              inventoryLoading.style.display = 'none';
              inventoryData.style.display = 'block';
              inventorySummary.innerHTML = `
                <div style="padding: 15px; background: rgba(221,51,51,0.2); border-radius: 8px; border-left: 3px solid var(--cs2-danger-red);">
                  <p style="color: var(--cs2-text-light);">Erro ao analisar seu invent√°rio. Por favor, tente novamente mais tarde.</p>
                  <p style="color: var(--cs2-text-light); margin-top: 8px;">Se o erro persistir, tente desconectar e conectar novamente.</p>
                </div>
              `;
              inventoryItems.innerHTML = '';
            });
        });
      }
      
      // Adicionar anima√ß√£o de rota√ß√£o para o loading
      const styleElement = document.createElement('style');
      styleElement.textContent = `
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `;
      document.head.appendChild(styleElement);
      
      // Taxa de c√¢mbio padr√£o (caso a API falhe)
      let CURRENCY_RATES = {
        USD_to_BRL: 5.05,
        EUR_to_BRL: 5.85,
        GBP_to_BRL: 6.70
      };
      const STEAM_TAX_FACTOR = 1.0; // Sem fator de taxa adicional
      
      // Fun√ß√£o para converter qualquer moeda para BRL
      function convertToBRL(price, currency) {
        if (!price || isNaN(parseFloat(price))) return 0;
        
        price = parseFloat(price);
        
        // J√° est√° em BRL
        if (currency === 'BRL') return price;
        
        // Converter com base na moeda
        if (currency === 'USD') {
          return price * CURRENCY_RATES.USD_to_BRL;
        } else if (currency === 'EUR') {
          return price * CURRENCY_RATES.EUR_to_BRL;
        } else if (currency === 'GBP') {
          return price * CURRENCY_RATES.GBP_to_BRL;
        }
        
        // Moeda n√£o suportada, usar USD como padr√£o
        console.warn(`Moeda ${currency} n√£o suportada, usando convers√£o de USD`);
        return price * CURRENCY_RATES.USD_to_BRL;
      }
      
      // Fun√ß√£o para obter a taxa de c√¢mbio atualizada
      async function getExchangeRate() {
        // Refer√™ncias aos elementos do indicador visual
        const exchangeRateIndicator = document.getElementById('exchange-rate-indicator');
        const exchangeRateText = document.getElementById('exchange-rate-text');
        
        // Atualizar indicador visual
        if (exchangeRateIndicator) {
          exchangeRateIndicator.style.backgroundColor = '#777';
          exchangeRateText.textContent = 'Atualizando taxa de c√¢mbio...';
        }
        
        try {
          // Verificar se j√° temos taxas armazenadas e se ainda s√£o v√°lidas (menos de 24 horas)
          const savedRates = localStorage.getItem('exchange_rates');
          const savedTimestamp = localStorage.getItem('exchange_rate_timestamp');
          
          if (savedRates && savedTimestamp) {
            const rateAge = Date.now() - parseInt(savedTimestamp);
            // Se a taxa foi atualizada nas √∫ltimas 24 horas, us√°-la
            if (rateAge < 24 * 60 * 60 * 1000) {
              console.log('Usando taxas de c√¢mbio em cache');
              CURRENCY_RATES = JSON.parse(savedRates);
              
              // Atualizar indicador visual
              if (exchangeRateIndicator) {
                exchangeRateIndicator.style.backgroundColor = 'var(--cs2-accent-green)';
                exchangeRateText.textContent = `1 USD = ${CURRENCY_RATES.USD_to_BRL.toFixed(2)} BRL`;
              }
              
              return CURRENCY_RATES;
            }
          }
          
          // Caso contr√°rio, buscar nova taxa
          // Usando API gratuita de Exchange Rates
          const response = await fetch('https://open.er-api.com/v6/latest/USD', {
            method: 'GET',
            headers: {
              'Accept': 'application/json'
            },
            mode: 'cors',
            cache: 'no-cache'
          });
          
          if (response.ok) {
            const data = await response.json();
            
            if (data && data.rates) {
              // Atualizar todas as taxas
              CURRENCY_RATES = {
                USD_to_BRL: data.rates.BRL || 5.05,
                EUR_to_BRL: data.rates.BRL / data.rates.EUR || 5.85,
                GBP_to_BRL: data.rates.BRL / data.rates.GBP || 6.70
              };
              
              console.log('Taxas de c√¢mbio atualizadas:', CURRENCY_RATES);
              
              // Armazenar as novas taxas e timestamp
              localStorage.setItem('exchange_rates', JSON.stringify(CURRENCY_RATES));
              localStorage.setItem('exchange_rate_timestamp', Date.now().toString());
              
              // Atualizar indicador visual
              if (exchangeRateIndicator) {
                exchangeRateIndicator.style.backgroundColor = 'var(--cs2-accent-green)';
                exchangeRateText.textContent = `1 USD = ${CURRENCY_RATES.USD_to_BRL.toFixed(2)} BRL`;
              }
              
              return CURRENCY_RATES;
            }
          }
          
          throw new Error('N√£o foi poss√≠vel obter as taxas de c√¢mbio atuais');
        } catch (error) {
          console.warn('Erro ao buscar taxas de c√¢mbio:', error);
          
          // Buscar alternativa se a primeira API falhar
          try {
            const altResponse = await fetch('https://api.exchangerate-api.com/v4/latest/USD', {
              method: 'GET',
              headers: {
                'Accept': 'application/json'
              },
              mode: 'cors'
            });
            
            if (altResponse.ok) {
              const altData = await altResponse.json();
              if (altData && altData.rates) {
                // Atualizar todas as taxas
                CURRENCY_RATES = {
                  USD_to_BRL: altData.rates.BRL || 5.05,
                  EUR_to_BRL: altData.rates.BRL / altData.rates.EUR || 5.85,
                  GBP_to_BRL: altData.rates.BRL / altData.rates.GBP || 6.70
                };
                
                console.log('Taxas de c√¢mbio alternativas:', CURRENCY_RATES);
                
                localStorage.setItem('exchange_rates', JSON.stringify(CURRENCY_RATES));
                localStorage.setItem('exchange_rate_timestamp', Date.now().toString());
                
                // Atualizar indicador visual
                if (exchangeRateIndicator) {
                  exchangeRateIndicator.style.backgroundColor = 'var(--cs2-accent-green)';
                  exchangeRateText.textContent = `1 USD = ${CURRENCY_RATES.USD_to_BRL.toFixed(2)} BRL`;
                }
                
                return CURRENCY_RATES;
              }
            }
          } catch (altError) {
            console.warn('Erro na API alternativa de c√¢mbio:', altError);
          }
          
          // Se todas as APIs falharem, usar os valores padr√£o
          console.log('Usando taxas de c√¢mbio padr√£o:', CURRENCY_RATES);
          
          // Atualizar indicador visual
          if (exchangeRateIndicator) {
            exchangeRateIndicator.style.backgroundColor = 'var(--cs2-danger-red)';
            exchangeRateText.textContent = `Taxa offline: 1 USD = ${CURRENCY_RATES.USD_to_BRL.toFixed(2)} BRL`;
          }
          
          return CURRENCY_RATES;
        }
      }
      
      // Inicializa√ß√£o
      checkApiStatus();  // Verificar status da API
      processUrlParams(); // Processar par√¢metros de URL para auth
      checkAuthStatus();  // Verificar estado de autentica√ß√£o
      getExchangeRate(); // Buscar taxa de c√¢mbio atual
      
      // Adicionar event listeners para bot√µes
      if (priceBtn) {
        console.log('Adicionando event listener para o bot√£o de busca de pre√ßo');
        priceBtn.addEventListener('click', getPrice);
      }
      
      // A funcionalidade de caixas foi removida
      
      // Conectar o bot√£o de exportar Excel com a fun√ß√£o
      if (exportExcelBtn) {
        exportExcelBtn.addEventListener('click', () => {
          // Verificar se h√° dados para exportar
          if (lastInventoryData) {
            exportToExcel(lastInventoryData);
          } else {
            alert('Nenhum dado dispon√≠vel para exportar. Fa√ßa uma an√°lise de invent√°rio primeiro.');
          }
        });
      }
      
      // Conectar o bot√£o de gerar dashboard com a fun√ß√£o
      const generateDashboardBtn = document.getElementById('generate-dashboard-btn');
      if (generateDashboardBtn) {
        generateDashboardBtn.addEventListener('click', () => {
          // Verificar se h√° dados para gerar a dashboard
          if (lastInventoryData) {
            generateDashboard(lastInventoryData);
          } else {
            alert('Nenhum dado dispon√≠vel para gerar dashboard. Fa√ßa uma an√°lise de invent√°rio primeiro.');
          }
        });
      }
    });
    
    // Fun√ß√£o para gerar dashboard interativa com Plotly
    function generateDashboard(data) {
      if (!data || !data.items || data.items.length === 0) {
        alert('Nenhum dado dispon√≠vel para gerar dashboard. Fa√ßa uma an√°lise de invent√°rio primeiro.');
        return;
      }
      
      console.log('Gerando dashboard interativa...');
      
      // Armazenar os dados no localStorage para que o dashboard.html possa acess√°-los
      localStorage.setItem('inventoryData', JSON.stringify(data));
      
      // Abrir o dashboard em uma nova janela
      window.open('dashboard.html', '_blank');
    }
  </script>

  <!-- Script para rolagem suave ao topo -->
  <script>
    // Captura todos os links com a classe scroll-top-link
    document.addEventListener('DOMContentLoaded', function() {
      const scrollTopLinks = document.querySelectorAll('.scroll-top-link');
      
      scrollTopLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          // Previne o comportamento padr√£o do link
          e.preventDefault();
          
          // Rola para o topo da p√°gina com efeito suave
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
      });
    });
  </script>
</body>
</html>